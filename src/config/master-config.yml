roles:
  partner:
    hierarchy: 0
    label: Partner
    type: auditor
    description: Full system access, exclusive CloseOut permission
    permissions_scope: global
    can_assign_roles: true
    can_manage_settings: true
  manager:
    hierarchy: 1
    label: Manager
    type: auditor
    description: Can create/edit entities, cannot delete or access settings
    permissions_scope: team
    can_assign_roles: false
    can_manage_settings: false
  clerk:
    hierarchy: 2
    label: Clerk
    type: auditor
    description: Read-only, except assigned entities with approval permission
    permissions_scope: assigned
    can_assign_roles: false
    can_manage_settings: false
  client_admin:
    hierarchy: 3
    label: Client Admin
    type: client
    description: Can view all RFIs for their client, rate engagements
    permissions_scope: client
    can_rate_engagement: true
    can_view_all_client_rfis: true
  client_user:
    hierarchy: 4
    label: Client User
    type: client
    description: Can only view assigned RFIs, cannot rate
    permissions_scope: assigned
    can_rate_engagement: false
    can_view_all_client_rfis: false
permission_templates:
  standard_auditor:
    description: Standard entity permissions for auditor team
    partner:
    - list
    - view
    - create
    - edit
    - delete
    - manage_settings
    - manage_team
    - archive
    - export
    manager:
    - list
    - view
    - create
    - edit
    - export
    clerk:
    - list
    - view
    client_admin:
    - list
    - view
    client_user:
    - view_assigned
  partner_only:
    description: Partner-exclusive entities (users, teams, settings)
    partner:
    - list
    - view
    - create
    - edit
    - delete
    - manage_settings
    - manage_team
    - manage_roles
    manager: []
    clerk: []
    client_admin: []
    client_user: []
  review_collaboration:
    description: Review/highlight collaboration permissions
    partner:
    - list
    - view
    - create
    - edit
    - delete
    - manage_collaborators
    - manage_highlights
    - resolve_highlight
    - reopen_highlight
    - manage_flags
    - archive
    manager:
    - list
    - view
    - create
    - edit
    - manage_collaborators_own
    - manage_highlights_own
    - resolve_highlight
    - reopen_highlight
    clerk:
    - list
    - view
    - view_assigned
    client_admin: []
    client_user: []
  client_response:
    description: Client-facing RFI response permissions
    partner:
    - list
    - view
    - create
    - edit
    - delete
    - change_status
    manager:
    - list
    - view
    - create
    - edit
    - change_status
    clerk:
    - list
    - view
    client_admin:
    - list
    - view
    - respond
    - upload_files
    client_user:
    - view_assigned
    - respond_assigned
    - upload_files_assigned
  admin_only:
    description: System admin operations only
    partner:
    - all
    manager: []
    clerk: []
    client_admin: []
    client_user: []
  audit_viewer:
    description: Permission audit trail viewing
    partner:
    - list
    - view
    - export
    - view_stats
    manager:
    - list
    - view
    - export
    - view_stats
    clerk:
    - list
    - view_own
    client_admin: []
    client_user: []
workflows:
  engagement_lifecycle:
    description: 6-stage engagement lifecycle workflow
    initial_stage: info_gathering
    final_stage: close_out
    stages:
    - name: info_gathering
      label: Info Gathering
      color: blue
      order: 1
      entry: default
      auto_transition: true
      auto_transition_trigger: date_reached(commencement_date)
      auto_transition_buffer_hours: 1
      forward:
      - commencement
      backward: []
      locks:
      - stage
      validation:
      - hasBasicInfo
      description: Initial data gathering phase before engagement starts
    - name: commencement
      label: Commencement
      color: blue
      order: 2
      entry: auto|manual
      auto_transition: false
      forward:
      - team_execution
      backward:
      - info_gathering
      locks: []
      validation:
      - hasEngagementLetter
      activates:
      - engagement_letter
      description: Engagement officially begins, letter generation enabled
    - name: team_execution
      label: Team Execution
      color: amber
      order: 3
      entry: manual
      auto_transition: false
      forward:
      - partner_review
      backward:
      - commencement
      locks: []
      validation:
      - hasTeam
      activates:
      - rfi_workflow
      description: Team performs audit work, RFI workflow active
    - name: partner_review
      label: Partner Review
      color: amber
      order: 4
      entry: manual
      auto_transition: false
      forward:
      - finalization
      backward:
      - team_execution
      locks: []
      validation: []
      requires_role:
      - partner
      description: Partner reviews team work before finalization
    - name: finalization
      label: Finalization
      color: green
      order: 5
      entry: manual
      auto_transition: false
      forward:
      - close_out
      backward:
      - partner_review
      locks: []
      validation:
      - reviewsComplete
      activates:
      - client_feedback
      - post_rfi
      description: Final stage before close out, client feedback enabled
    - name: close_out
      label: Close Out
      color: green
      order: 6
      entry: partner_only
      auto_transition: false
      forward: []
      backward: []
      locks:
      - all
      validation:
      - letterAcceptedOrCancelled
      requires_role:
      - partner
      readonly: true
      description: Engagement complete and locked, partner-only access
  rfi_type_standard:
    description: Standard RFI workflow with escalation
    name: RFI
    type: standard
    internal_states:
    - pending
    - sent
    - responded
    - completed
    display_states:
      auditor:
      - requested
      - reviewing
      - queries
      - received
      client:
      - pending
      - partially_sent
      - sent
      - completed
    fields:
    - date_requested
    - date_resolved
    - deadline
    - response_count
    - files_count
    - days_outstanding
    requires_completion: file_upload OR text_response
    notifications:
      escalation_thresholds:
      - 3
      - 7
      - 14
      deadline_warnings:
      - 7
      - 3
      - 1
      - 0
  rfi_type_post_rfi:
    description: Post-RFI workflow (finalization stage)
    name: Post-RFI
    type: post_rfi
    internal_states:
    - pending
    - sent
    - accepted
    display_states:
      auditor:
      - pending
      - sent
      client:
      - pending
      - queries
      - accepted
    fields:
    - date_requested
    - date_resolved
    - response_count
    - files_count
    requires_completion: file_upload OR text_response
    notifications:
      escalation_thresholds: []
      deadline_warnings: []
  review_lifecycle:
    description: Review status workflow
    initial_status: open
    final_status: closed
    states:
    - name: open
      label: Open
      color: yellow
      forward:
      - closed
      backward: []
    - name: closed
      label: Closed
      color: green
      forward: []
      backward:
      - open
  highlight_resolution:
    description: Highlight resolution workflow with immutability
    initial_status: unresolved
    final_status: resolved
    states:
    - name: unresolved
      label: Unresolved
      color: grey
      forward:
      - resolved
      backward: []
      actions:
      - resolve_highlight
    - name: resolved
      label: Resolved
      color: green
      forward: []
      backward:
      - unresolved
      readonly: true
      actions:
      - reopen_highlight
  rfi_response_lifecycle:
    description: RFI response review and acceptance workflow
    initial_status: submitted
    final_status: accepted
    states:
    - name: submitted
      label: Submitted
      color: blue
      forward:
      - reviewed
      - accepted
      backward: []
      actions:
      - submit_response
      validation:
      - hasResponseText
      - hasRequiredFiles
      description: Response submitted by client or auditor
    - name: reviewed
      label: Reviewed
      color: amber
      forward:
      - accepted
      - rejected
      backward:
      - submitted
      actions:
      - review_response
      requires_role:
      - partner
      - manager
      validation:
      - hasReviewer
      description: Response under review by auditor
    - name: rejected
      label: Rejected
      color: red
      forward:
      - submitted
      backward: []
      actions:
      - reject_response
      - resubmit_response
      requires_role:
      - partner
      - manager
      validation:
      - hasRejectionReason
      description: Response rejected, requires resubmission
    - name: accepted
      label: Accepted
      color: green
      forward: []
      backward: []
      actions:
      - accept_response
      requires_role:
      - partner
      - manager
      readonly: true
      description: Response accepted, RFI complete
thresholds:
  rfi:
    notification_days:
    - 7
    - 3
    - 1
    - 0
    aging_thresholds:
    - 3
    - 7
    - 14
    escalation_delay_hours: 24
    max_days_outstanding: 90
  collaborator:
    default_expiry_days: 7
    max_expiry_days: 30
    notify_before_expiry_hours: 24
    cleanup_after_expiry_hours: 0
  tender:
    warning_days_before: 7
    default_deadline_days: 30
    urgent_threshold_days: 3
  engagement:
    auto_transition_buffer_hours: 1
    archive_after_days: 365
    min_year: 2020
    max_year: 2099
  workflow:
    closeout_after_days: 30
    completion_after_days: 7
    stage_transition_lockout_minutes: 5
  notification:
    batch_size: 50
    retry_attempts: 3
    retry_delay_minutes: 15
    consolidation_window_hours: 24
  email:
    send_batch_size: 10
    send_max_retries: 3
    rate_limit_delay_ms: 6000
    retry_max_delay_ms: 30000
    default_sender: system@bidwise.app
    retry_base_delay_ms: 1000
    failure_rate_window_seconds: 86400
    high_failure_rate_threshold: 0.5
    failure_alert_min_emails: 10
    recent_failures_limit: 10
    allocation_confidence_base: 50
    allocation_confidence_subject_bonus: 30
    allocation_confidence_body_bonus: 20
    allocation_min_body_length: 50
  retry:
    max_attempts: 3
    max_delay_ms: 30000
    backoff_multiplier: 2
  system:
    database_busy_timeout_ms: 5000
    poll_interval_ms: 3000
    max_active_subscriptions: 100
    default_page_size: 50
    max_page_size: 500
  cache:
    entity_ttl_seconds: 300
    list_ttl_seconds: 60
    session_ttl_seconds: 3600
    max_entries: 1000
    permission_ttl_ms: 300000           # 5 minutes
    field_metadata_ttl_ms: 3600000      # 1 hour
    session_ttl_ms: 600000              # 10 minutes
    user_profile_ttl_ms: 300000         # 5 minutes
    entity_ttl_ms: 1800000              # 30 minutes
    token_ttl_ms: 86400000              # 24 hours
    max_size: 100
    max_age_ms: 86400000                # 24 hours

  cache_advanced:
    permission_ttl_ms: 300000           # 5 minutes
    field_metadata_ttl_ms: 3600000      # 1 hour
    session_ttl_ms: 600000              # 10 minutes
    user_profile_ttl_ms: 300000         # 5 minutes
    entity_ttl_ms: 1800000              # 30 minutes
    token_ttl_ms: 86400000              # 24 hours
    max_size: 100
    max_age_ms: 86400000                # 24 hours

  audit:
    recent_activity_days: 7
    default_limit: 100
    user_activity_limit: 50
    recent_changes_display: 10
    anomalous_activity_threshold: 10
    summary_report_days: 30
    export_max_limit: 10000

  query:
    default_list_limit: 100
    default_search_limit: 50
    export_limit: 1000
    max_limit: 10000
    default_page_size: 20
    default_timeout_ms: 30000

  polling:
    interval_ms: 3000
    max_backoff_ms: 30000
    backoff_multiplier: 2
    max_retries: 3

  timeline:
    week_threshold_days: 7
    month_threshold_days: 30

  ui:
    debounce_delay_ms: 300

  highlight:
    min_consolidation_count: 2

  search:
    max_index_size: 10000

  debug:
    max_api_calls: 50
    max_errors: 100
    max_permission_cache: 1000

engagement_status_types:
  engagement_client_status:
    description: Tracks engagement status from client perspective
    options:
      - value: pending
        label: Pending
        color: grey
        description: Awaiting client action
      - value: in_progress
        label: In Progress
        color: blue
        description: Client reviewing engagement details
      - value: responded
        label: Responded
        color: green
        description: Client has provided feedback
      - value: completed
        label: Completed
        color: green
        description: Engagement complete from client view
  engagement_letter_client_status:
    description: Tracks engagement letter status from client perspective
    options:
      - value: pending
        label: Pending
        color: grey
        description: Letter not yet received
      - value: received
        label: Received
        color: blue
        description: Letter received by client
      - value: accepted
        label: Accepted
        color: green
        description: Letter accepted by client
      - value: cancelled
        label: Cancelled
        color: red
        description: Letter cancelled
  engagement_letter_auditor_status:
    description: Tracks engagement letter status from auditor perspective
    options:
      - value: pending
        label: Pending
        color: grey
        description: Letter generation not started
      - value: draft
        label: Draft
        color: blue
        description: Letter in draft stage
      - value: sent
        label: Sent
        color: blue
        description: Letter sent to client
      - value: accepted
        label: Accepted
        color: green
        description: Client accepted letter
      - value: cancelled
        label: Cancelled
        color: red
        description: Letter cancelled
  engagement_post_rfi_client_status:
    description: Tracks post-RFI status from client perspective
    options:
      - value: pending
        label: Pending
        color: grey
        description: Awaiting post-RFI submission
      - value: received
        label: Received
        color: blue
        description: Post-RFI received from client
      - value: accepted
        label: Accepted
        color: green
        description: Post-RFI accepted
      - value: rejected
        label: Rejected
        color: red
        description: Post-RFI requires revision
  engagement_post_rfi_auditor_status:
    description: Tracks post-RFI status from auditor perspective
    options:
      - value: pending
        label: Pending
        color: grey
        description: Post-RFI not yet issued
      - value: issued
        label: Issued
        color: blue
        description: Post-RFI issued to client
      - value: under_review
        label: Under Review
        color: blue
        description: Post-RFI response under review
      - value: accepted
        label: Accepted
        color: green
        description: Post-RFI accepted
      - value: needs_revision
        label: Needs Revision
        color: red
        description: Post-RFI needs revision
  engagement_auditor_status:
    description: Tracks engagement status from auditor perspective
    options:
      - value: requested
        label: Requested
        color: grey
        description: Engagement created
      - value: in_progress
        label: In Progress
        color: blue
        description: Team actively working on engagement
      - value: under_partner_review
        label: Under Partner Review
        color: blue
        description: Partner reviewing work
      - value: pending_finalization
        label: Pending Finalization
        color: amber
        description: Awaiting finalization
      - value: completed
        label: Completed
        color: green
        description: Engagement work complete
      - value: closed_out
        label: Closed Out
        color: green
        description: Engagement closed out

entities:
  engagement:
    label: Engagement
    label_plural: Engagements
    icon: Briefcase
    order: 2
    permission_template: standard_auditor
    workflow: engagement_lifecycle
    row_access:
      scope: assigned_or_team
    computed_fields:
    - progress
    - daysOutstanding
    - createdBy
    - assignedTo
    has_timeline: true
    has_roles:
    - partner
    - manager
    - clerk
    parent: null
    children:
    - rfi
    - review
    - letter
    - rfi_section
    recreation_enabled: true
    recreation_intervals:
    - once
    - monthly
    - yearly
    fields:
      id:
        type: id
        required: true
      name:
        type: text
        required: true
        search: true
        list: true
        label: Engagement Name
      client_id:
        type: ref
        ref: client
        required: true
        search: true
        list: true
        label: Client
      year:
        type: number
        required: true
        search: true
        list: true
        label: Year
      status:
        type: text
        default: active
        label: Status
      commencement_date:
        type: timestamp
        label: Commencement Date
        description: Date when the engagement officially begins
      stage:
        type: enum
        default: info_gathering
        required: true
        list: true
        label: Stage
      progress:
        type: number
        default: 0
        label: Progress
      created_at:
        type: timestamp
        required: true
        auto: now
        auto_generate: true
        readOnly: true
      updated_at:
        type: timestamp
        auto: update
        auto_generate: true
        readOnly: true
      created_by:
        type: ref
        ref: user
        auto: user
        auto_generate: true
        readOnly: true
    field_overrides:
      stage:
        type: enum
        options: engagement_lifecycle.stages[].name
        validator: lifecycle_stage_transition
      client_status:
        type: enum
        options: engagement_client_status
      letter_client_status:
        type: enum
        options: engagement_letter_client_status
      letter_auditor_status:
        type: enum
        options: engagement_letter_auditor_status
      post_rfi_client_status:
        type: enum
        options: engagement_post_rfi_client_status
      post_rfi_auditor_status:
        type: enum
        options: engagement_post_rfi_auditor_status
      auditor_status:
        type: enum
        options: engagement_auditor_status
      year:
        min: $thresholds.engagement.min_year
        max: $thresholds.engagement.max_year
      transition_attempts:
        type: number
        default: 0
        description: Counter for auto-transition attempts
      last_transition_check:
        type: timestamp
        description: Last time auto-transition was checked for this engagement
      last_transition_at:
        type: timestamp
        description: Timestamp of last manual stage transition (for lockout enforcement)
      client_rating:
        type: number
        min: 0
        max: 5
        default: null
        label: Client Rating
        description: Client satisfaction rating (0-5 stars)
        required: false
  rfi:
    label: Request For Information
    label_plural: RFIs
    icon: HelpCircle
    order: 8
    permission_template: client_response
    workflow: rfi_type_standard
    row_access:
      scope: client
    computed_fields:
    - days_outstanding
    - daysOutstanding
    parent: engagement
    children:
    - message
    - file
    - rfi_response
    variants:
      post_rfi:
        workflow: rfi_type_post_rfi
        permission_template: client_response
        activates_at_stage: finalization
    state_machine: true
    has_notifications: true
    fields:
      id:
        type: id
        required: true
      title:
        type: text
        required: true
        search: true
        list: true
        label: Title
      engagement_id:
        type: ref
        ref: engagement
        required: true
        list: true
        label: Engagement
        description: Parent engagement
      status:
        type: enum
        options:
          - value: open
            label: Open
            color: yellow
          - value: pending_response
            label: Pending Response
            color: blue
          - value: responded
            label: Responded
            color: green
          - value: closed
            label: Closed
            color: gray
        default: open
        list: true
        label: Status
      assigned_to:
        type: ref
        ref: user
        list: true
        label: Assigned To
      due_date:
        type: date
        list: true
        label: Due Date
      description:
        type: textarea
        label: Description
      priority:
        type: enum
        options:
          - value: low
            label: Low
            color: gray
          - value: medium
            label: Medium
            color: yellow
          - value: high
            label: High
            color: red
        default: medium
        label: Priority
    field_overrides:
      response_count:
        type: number
        default: 0
        description: Auto-incrementing when new responses created
      last_response_date:
        type: timestamp
        description: Timestamp of most recent response
      primary_response_id:
        type: ref
        ref: rfi_response
        description: Currently active response
  review:
    label: Review
    label_plural: Reviews
    icon: FileText
    order: 3
    permission_template: review_collaboration
    workflow: review_lifecycle
    computed_fields:
    - progress
    - createdBy
    - assignedTo
    parent: engagement
    children:
    - highlight
    - collaborator
    - checklist
    - flag
    has_pdf_viewer: true
    has_collaboration: true
    has_tender_tracking: true
    fields:
      id:
        type: id
        required: true
      name:
        type: text
        required: true
        search: true
        label: Review Name
      engagement_id:
        type: ref
        ref: engagement
        required: true
        label: Engagement
      status:
        type: enum
        options: engagement_lifecycle.stages[].name
        default: active
        label: Status
      drive_file_id:
        type: text
        label: Google Drive File ID
      financial_year:
        type: text
        label: Financial Year
      team_id:
        type: ref
        ref: team
        label: Team
      deadline:
        type: date
        label: Deadline
      wip_value:
        type: decimal
        precision: 2
        label: WIP Value
      is_private:
        type: bool
        default: false
        label: Private Review
      created_at:
        type: timestamp
        required: true
        auto: now
        auto_generate: true
        readOnly: true
      updated_at:
        type: timestamp
        auto: update
        auto_generate: true
        readOnly: true
      created_by:
        type: ref
        ref: user
        auto: user
        auto_generate: true
        readOnly: true
    list:
      component: review-list
    detail:
      component: review-detail
  highlight:
    label: Highlight
    label_plural: Highlights
    icon: Highlighter
    order: 10
    permission_template: review_collaboration
    workflow: highlight_resolution
    parent: review
    immutable: true
    immutable_strategy: move_to_archive
    has_color_palette: true
    has_position_data: true
    fields:
      review_id:
        type: ref
        ref: review
        required: true
        description: Parent review
    field_overrides:
      status:
        type: enum
        options:
        - unresolved
        - resolved
        default: unresolved
      archived:
        type: bool
        default: false
      archived_at:
        type: timestamp
      archived_by:
        type: ref
        ref: user
      resolution_notes:
        type: text
      resolved_at:
        type: timestamp
      resolved_by:
        type: ref
        ref: user
      color:
        type: enum
        options:
        - grey
        - green
        - red
        - purple
        default: grey
      is_high_priority:
        type: bool
        default: false
      is_active_focus:
        type: bool
        default: false

  highlight_comment:
    label: Highlight Comment
    label_plural: Highlight Comments
    icon: MessageCircle
    order: 10.5
    permission_template: review_collaboration
    parent: highlight
    fields:
      highlight_id:
        type: ref
        ref: highlight
        required: true
        description: Parent highlight
    field_overrides:
      text:
        type: text
        required: true
      author_id:
        type: ref
        ref: user
        required: true
      created_at:
        type: timestamp
        required: true
        auto: now
        auto_generate: true
        readOnly: true
      thread_id:
        type: string
      parent_comment_id:
        type: ref
        ref: highlight_comment

  removedHighlight:
    label: Removed Highlight
    label_plural: Removed Highlights
    icon: Trash
    order: 10.6
    permission_template: partner_only
    immutable: true
    fields:
      review_id:
        type: ref
        ref: review
        required: true
        description: Parent review
      original_id:
        type: text
        required: true
        description: Original highlight ID
    field_overrides:
      deleted_at:
        type: timestamp
        required: true
      deleted_by:
        type: ref
        ref: user
        required: true
      archived_by:
        type: ref
        ref: user
      resolution_notes:
        type: text
      color:
        type: enum
        options:
        - grey
        - green
        - red
        - purple
      is_high_priority:
        type: bool
        default: false

  collaborator:
    label: Collaborator
    label_plural: Collaborators
    icon: Users
    order: 11
    permission_template: partner_only
    parent: review
    has_temporary_access: true
    has_auto_revoke: true
    default_expiry_days: $thresholds.collaborator.default_expiry_days
    max_expiry_days: $thresholds.collaborator.max_expiry_days
    fields:
      id:
        type: id
        required: true
      review_id:
        type: ref
        ref: review
        required: true
        description: Parent review
      email:
        type: text
        label: Email
        required: true
        search: true
      expires_at:
        type: timestamp
        label: Expires At
        description: When this collaborator access expires
        required: false
      is_permanent:
        type: bool
        label: Is Permanent
        description: Whether this access is permanent and never expires
        default: true
        required: false
      notified_at:
        type: timestamp
        label: Expiry Notification Sent At
        description: Timestamp when 7-day expiry warning was sent
        required: false
      created_at:
        type: timestamp
        required: true
        auto: now
        auto_generate: true
        readOnly: true
      updated_at:
        type: timestamp
        required: true
        auto: update
        auto_generate: true
        readOnly: true
      created_by:
        type: ref
        ref: user
        auto: user
        auto_generate: true
        readOnly: true
  checklist:
    label: Checklist
    label_plural: Checklists
    icon: CheckSquare
    order: 12
    permission_template: standard_auditor
    parent: review
    auto_complete_when: all_items_done
    has_pdf_generation: true
    fields:
      id:
        type: id
        required: true
      review_id:
        type: ref
        ref: review
        required: true
        description: Parent review
      name:
        type: text
        required: true
        search: true
        label: Checklist Name
      section_items:
        type: json
        label: Section Items
        description: JSON array of checklist items
      email_checklist:
        type: bool
        default: false
        label: Email Checklist
      type:
        type: text
        label: Checklist Type
      description:
        type: textarea
        label: Description
      created_at:
        type: timestamp
        required: true
        auto: now
        auto_generate: true
        readOnly: true
      updated_at:
        type: timestamp
        auto: update
        auto_generate: true
        readOnly: true
      created_by:
        type: ref
        ref: user
        auto: user
        auto_generate: true
        readOnly: true
    children:
    - checklist_item
  checklist_item:
    label: Checklist Item
    label_plural: Checklist Items
    icon: CheckCircle
    order: 13
    permission_template: standard_auditor
    parent: checklist
    fields:
      id:
        type: id
        required: true
      checklist_id:
        type: ref
        ref: checklist
        required: true
        search: true
      name:
        type: text
        required: true
        search: true
      description:
        type: textarea
        search: true
      is_done:
        type: bool
        default: false
      assigned_to:
        type: ref
        ref: user
      due_date:
        type: timestamp
      order:
        type: int
        default: 0
        sortable: true
      created_at:
        type: timestamp
        required: true
        auto: now
        auto_generate: true
        readOnly: true
      updated_at:
        type: timestamp
        required: true
        auto: update
        auto_generate: true
        readOnly: true
      created_by:
        type: ref
        ref: user
        auto: user
        auto_generate: true
        readOnly: true
      updated_by:
        type: ref
        ref: user
  user:
    label: User
    label_plural: Users
    icon: User
    order: 1
    permission_template: partner_only
    has_authentication: true
    has_google_sync: true
    user_types:
    - auditor
    - client
    roles:
    - partner
    - manager
    - clerk
    - client_admin
    - client_user
    field_overrides:
      email:
        type: text
        required: true
        unique: true
        label: Email
      name:
        type: text
        required: true
        label: Name
      password_hash:
        type: text
        label: Password Hash
        hidden: true
      role:
        type: text
        required: true
        default: clerk
        label: Role
      status:
        type: text
        default: active
        label: Status
      photo_url:
        type: text
        label: Photo URL
      priority_reviews:
        type: json
        default: []
        label: Priority Reviews
        description: Array of review IDs marked as priority by this user
  team:
    label: Team
    label_plural: Teams
    icon: Users
    order: 4
    permission_template: partner_only
    children:
    - user
  client:
    label: Client
    label_plural: Clients
    icon: Building
    order: 5
    permission_template: standard_auditor
    children:
    - engagement
    - client_user
    fields:
      id:
        type: id
        required: true
        list: true
      name:
        type: text
        label: Name
        required: true
        list: true
        search: true
      code:
        type: text
        label: Client Code
        search: true
      industry:
        type: text
        label: Industry
        search: true
      contact_name:
        type: text
        label: Contact Name
        search: true
      contact_email:
        type: text
        label: Contact Email
        search: true
      contact_phone:
        type: text
        label: Contact Phone
      email:
        type: text
        label: Email
        list: true
        search: true
      phone:
        type: text
        label: Phone
        list: true
      address:
        type: textarea
        label: Address
      website:
        type: text
        label: Website
      status:
        type: enum
        options:
          - value: active
            label: Active
            color: green
          - value: inactive
            label: Inactive
            color: gray
          - value: prospect
            label: Prospect
            color: blue
        default: active
        list: true
        label: Status
      risk_level:
        type: enum
        options:
          - value: low
            label: Low
            color: green
          - value: medium
            label: Medium
            color: yellow
          - value: high
            label: High
            color: orange
          - value: critical
            label: Critical
            color: red
        default: low
        label: Risk Level
      risk_notes:
        type: textarea
        label: Risk Notes
      risk_assessed_at:
        type: timestamp
        label: Risk Assessed At
      created_at:
        type: timestamp
        label: Created At
        auto: now
        auto_generate: true
        required: true
        list: true
        readOnly: true
      updated_at:
        type: timestamp
        label: Updated At
        auto: update
        auto_generate: true
        list: true
        readOnly: true
      created_by:
        type: ref
        ref: user
        label: Created By
        auto: user
        auto_generate: true
        readOnly: true
  client_user:
    label: Client User
    label_plural: Client Users
    icon: UserCheck
    order: 6
    permission_template: admin_only
    parent: client
    fields:
      client_id:
        type: ref
        ref: client
        required: true
        description: Parent client
    linked_entity: user
  tender:
    label: Tender
    label_plural: Tenders
    icon: Award
    order: 7
    permission_template: standard_auditor
    parent: review
    default_deadline_days: $thresholds.tender.default_deadline_days
    warning_threshold_days: $thresholds.tender.warning_days_before
    has_deadline_tracking: true
    fields:
      id:
        type: id
        required: true
      review_id:
        type: ref
        ref: review
        required: true
        search: true
      name:
        type: text
        required: true
        search: true
      description:
        type: textarea
        search: true
      tender_type:
        type: enum
        options:
        - government
        - private_sector
        - nonprofit
        - education
        - other
        default: other
        required: true
        search: true
      tender_status:
        type: enum
        options:
        - open
        - closed
        - awarded
        - cancelled
        default: open
        required: true
        search: true
      priority_level:
        type: enum
        options:
        - low
        - medium
        - high
        - critical
        default: medium
        required: true
        search: true
      estimated_value:
        type: number
        min: 0
      actual_value:
        type: number
        min: 0
      response_count:
        type: number
        default: 0
        min: 0
      awarded_to:
        type: text
        search: true
      cancelled_reason:
        type: text
      classification:
        type: text
        search: true
      deadline:
        type: timestamp
        required: true
      award_date:
        type: timestamp
      created_at:
        type: timestamp
        required: true
        auto: now
        auto_generate: true
        readOnly: true
      updated_at:
        type: timestamp
        required: true
        auto: update
        auto_generate: true
        readOnly: true
      created_by:
        type: ref
        ref: user
        auto: user
        auto_generate: true
        readOnly: true
      updated_by:
        type: ref
        ref: user
  letter:
    label: Engagement Letter
    label_plural: Engagement Letters
    icon: FileText
    order: 9
    permission_template: standard_auditor
    parent: engagement
    fields:
      engagement_id:
        type: ref
        ref: engagement
        required: true
        description: Parent engagement
    document_type: engagement_letter
    has_google_drive_integration: true
    has_template_variables: true
  review_template:
    label: Review Template
    label_plural: Review Templates
    icon: FileText
    order: 9.5
    permission_template: standard_auditor
    parent: null
    children:
    - template_section
    fields:
      id:
        type: id
        required: true
      name:
        type: text
        required: true
        search: true
        label: Template Name
      description:
        type: textarea
        label: Description
      type:
        type: enum
        options:
        - standard
        - complex
        - financial
        - compliance
        default: standard
        label: Template Type
        search: true
      content:
        type: textarea
        label: Template Content
        required: true
      variables:
        type: json
        label: Template Variables
        description: JSON array of variable names used in template
      is_active:
        type: bool
        default: true
        label: Is Active
      created_at:
        type: timestamp
        required: true
        auto: now
        auto_generate: true
        readOnly: true
      updated_at:
        type: timestamp
        required: true
        auto: update
        auto_generate: true
        readOnly: true
      created_by:
        type: ref
        ref: user
        auto: user
        auto_generate: true
        readOnly: true
  template_section:
    label: Template Section
    label_plural: Template Sections
    icon: Folder
    order: 10
    permission_template: standard_auditor
    parent: review_template
    fields:
      id:
        type: id
        required: true
      template_id:
        type: ref
        ref: review_template
        required: true
        search: true
      name:
        type: text
        required: true
        search: true
      order:
        type: int
        default: 0
      content:
        type: textarea
        required: true
      created_at:
        type: timestamp
        required: true
        auto: now
        auto_generate: true
        readOnly: true
      updated_at:
        type: timestamp
        required: true
        auto: update
        auto_generate: true
        readOnly: true
      created_by:
        type: ref
        ref: user
        auto: user
        auto_generate: true
        readOnly: true
  rfi_section:
    label: RFI Section
    label_plural: RFI Sections
    icon: Folder
    order: 13
    permission_template: standard_auditor
    parent: engagement
    fields:
      engagement_id:
        type: ref
        ref: engagement
        required: true
        description: Parent engagement
    children:
    - rfi
  flag:
    label: Flag
    label_plural: Flags
    icon: Flag
    order: 14
    permission_template: review_collaboration
    parent: review
    fields:
      id:
        type: id
        label: ID
        required: true
      review_id:
        type: ref
        ref: review
        required: true
        description: Parent review
      flag_type:
        type: text
        description: Type of flag
      applied_by:
        type: ref
        ref: user
        description: User who applied the flag
      applied_at:
        type: timestamp
        description: When flag was applied
      created_at:
        type: timestamp
        auto: now
        required: true
      updated_at:
        type: timestamp
        auto: update
      created_by:
        type: ref
        ref: user
        auto: user
    flag_types:
    - review_comment
    - highlight
    - priority
  message:
    label: Message
    label_plural: Messages
    icon: MessageSquare
    order: 15
    permission_template: client_response
    parent: rfi
    has_email_integration: true
    has_emoji_reactions: true
    fields:
      rfi_id:
        type: ref
        ref: rfi
        required: true
        description: Parent RFI
      reactions:
        type: json
        default: '{}'
        label: Reactions
        description: Map of emoji to array of user IDs who reacted
      mentions:
        type: json
        default: '[]'
        label: Mentions
        description: Array of mentioned user names
  file:
    label: File
    label_plural: Files
    icon: Paperclip
    order: 16
    permission_template: client_response
    parent: rfi
    has_google_drive_integration: true
    fields:
      id:
        type: id
        required: true
      rfi_id:
        type: ref
        ref: rfi
        required: true
        description: Parent RFI
      path:
        type: text
        label: File Path
        description: Storage path where file is located
        required: false
        search: true
      size:
        type: int
        label: File Size
        description: Size of the file in bytes
        required: false
      mime_type:
        type: text
        label: MIME Type
        description: Content type of the file
        required: false
      storage_type:
        type: text
        label: Storage Type
        description: Where file is stored (local, drive, etc)
        required: false
      created_at:
        type: timestamp
        required: true
        auto: now
        auto_generate: true
        readOnly: true
      updated_at:
        type: timestamp
        required: true
        auto: update
        auto_generate: true
        readOnly: true
      created_by:
        type: ref
        ref: user
        auto: user
        auto_generate: true
        readOnly: true
  rfi_response:
    label: RFI Response
    label_plural: RFI Responses
    icon: Reply
    order: 17
    permission_template: client_response
    parent: rfi
    workflow: rfi_response_lifecycle
    has_notifications: true
    has_file_attachments: true
    track_response_chain: true
    single_active_per_rfi: true
    fields:
      id:
        type: id
        required: true
      rfi_id:
        type: ref
        ref: rfi
        required: true
        search: true
      response_type:
        type: enum
        options:
        - client_response
        - auditor_response
        - clarification
        required: true
        default: client_response
      responder_id:
        type: ref
        ref: user
        required: true
      response_text:
        type: textarea
        required: true
        search: true
      response_date:
        type: timestamp
        required: true
        default: now()
      file_attachments:
        type: json
        description: Array of file references attached to this response
      is_complete:
        type: bool
        default: false
        description: True if response fully answers the RFI
      clarification_needed:
        type: bool
        default: false
        description: True if partial response needing follow-up
      reviewed_by:
        type: ref
        ref: user
      reviewed_at:
        type: timestamp
      status:
        type: enum
        options:
        - submitted
        - reviewed
        - rejected
        - accepted
        default: submitted
        required: true
      rejection_reason:
        type: textarea
      response_chain_id:
        type: text
        description: Groups related responses (original + resubmissions)
        search: true
      parent_response_id:
        type: ref
        ref: rfi_response
        description: Previous response if this is a resubmission
      created_at:
        type: timestamp
        required: true
        auto: now
        auto_generate: true
        readOnly: true
      updated_at:
        type: timestamp
        required: true
        auto: update
        auto_generate: true
        readOnly: true
      created_by:
        type: ref
        ref: user
        auto: user
        auto_generate: true
        readOnly: true
      updated_by:
        type: ref
        ref: user
  email:
    label: Email
    label_plural: Emails
    icon: Mail
    order: 18
    permission_template: admin_only
    has_queue: true
    has_templates: true
    fields:
      id:
        type: id
        required: true
      sender_email:
        type: email
        required: true
        search: true
      sender_name:
        type: text
        search: true
      recipient_email:
        type: email
        required: true
        search: true
      cc:
        type: text
      bcc:
        type: text
      subject:
        type: text
        required: true
        search: true
      body:
        type: textarea
        search: true
      html_body:
        type: textarea
      message_id:
        type: text
        unique: true
      in_reply_to:
        type: text
      references:
        type: text
      received_at:
        type: timestamp
        required: true
      allocated:
        type: bool
        default: false
      engagement_id:
        type: ref
        ref: engagement
      rfi_id:
        type: ref
        ref: rfi
      attachments:
        type: json
      status:
        type: enum
        options:
        - pending
        - processing
        - processed
        - failed
        default: pending
      processed:
        type: bool
        default: false
      processed_at:
        type: timestamp
      retry_count:
        type: number
        default: 0
      processing_error:
        type: text
      bounce_reason:
        type: text
      bounced_at:
        type: timestamp
      bounce_permanent:
        type: bool
        default: false
      created_at:
        type: timestamp
        auto: 'now'
        readOnly: true
      updated_at:
        type: timestamp
        auto: 'update'
        readOnly: true
      created_by:
        type: ref
        ref: user
        auto: 'user'
        readOnly: true
  job_execution_log:
    label: Job Execution Log
    label_plural: Job Execution Logs
    icon: Clock
    order: 19
    permission_template: admin_only
    system_entity: true
    fields:
      timestamp:
        type: timestamp
        required: true
      total_jobs:
        type: number
        required: true
      executed_jobs:
        type: number
        required: true
      failed_jobs:
        type: number
        required: true
      duration_ms:
        type: number
      status:
        type: enum
        options:
        - success
        - partial_failure
        - error
        required: true
      error_details:
        type: text
  permission_audit:
    label: Permission Audit
    label_plural: Permission Audits
    icon: Shield
    order: 20
    permission_template: audit_viewer
    parent: null
    has_timeline: false
    immutable: true
    description: Audit trail for all permission-related changes
    fields:
      id:
        type: id
        required: true
      user_id:
        type: ref
        ref: user
        required: true
        search: true
        label: Changed By
        description: User who made the permission change
      entity_type:
        type: text
        required: true
        search: true
        label: Entity Type
        description: Type of entity affected (engagement, review, user, etc.)
      entity_id:
        type: text
        required: true
        search: true
        label: Entity ID
        description: ID of specific record affected
      action:
        type: enum
        required: true
        options:
          - grant
          - revoke
          - modify
          - role_change
          - template_applied
        default: modify
        label: Action Type
        description: Type of permission change
      old_permissions:
        type: json
        required: false
        label: Previous Permissions
        description: Permission state before change
      new_permissions:
        type: json
        required: false
        label: New Permissions
        description: Permission state after change
      reason:
        type: textarea
        required: false
        search: true
        label: Reason
        description: Why the permission change was made
      reason_code:
        type: enum
        required: true
        options:
          - user_request
          - lifecycle_transition
          - role_change
          - admin_action
          - collaborator_added
          - collaborator_removed
          - team_assignment
          - other
        default: other
        label: Reason Code
        description: Categorized reason for change
      timestamp:
        type: timestamp
        required: true
        default: now()
        label: Change Time
        description: When the permission change occurred
      ip_address:
        type: text
        required: false
        label: IP Address
        description: IP address of user who made change
      session_id:
        type: text
        required: false
        label: Session ID
        description: Session identifier for tracking
      affected_user_id:
        type: ref
        ref: user
        required: false
        search: true
        label: Affected User
        description: User whose permissions were changed (if applicable)
      metadata:
        type: json
        required: false
        label: Additional Metadata
        description: Extra context about the permission change
      created_at:
        type: timestamp
        required: true
        auto: now
        auto_generate: true
        readOnly: true
      updated_at:
        type: timestamp
        required: true
        auto: update
        auto_generate: true
        readOnly: true
      created_by:
        type: ref
        ref: user
        auto: user
        auto_generate: true
        readOnly: true
      updated_by:
        type: ref
        ref: user

domains:
  friday:
    label: Friday Engagements
    description: Friday engagement and RFI workflow
    enabled: true
    entities:
    - engagement
    - rfi
    - rfi_section
    - letter
    - client
    - user
    - team
    - client_user
  mwr:
    label: MyWorkReview
    description: Review and collaboration platform
    enabled: true
    entities:
    - review
    - highlight
    - highlight_comment
    - removedHighlight
    - collaborator
    - checklist
    - checklist_item
    - tender
    - message
    - file
    - rfi_response
    - review_template
    - template_section
    - flag
    - user
    - team
    - email
    - job_execution_log
    - permission_audit

automation:
  schedules:
  - name: daily_backup
    trigger: 0 2 * * *
    description: Export database to backup
    action: export_database
    entity: null
    enabled: true
    timezone: UTC
  - name: user_sync
    trigger: 0 2 * * *
    description: Sync users from Google Workspace
    action: sync_users_from_google_workspace
    entity: user
    enabled: true
    rule: user.type == 'auditor'
    integration: google_workspace
  - name: daily_engagement_auto_transitions
    trigger: 0 4 * * *
    description: Auto-transition engagements through lifecycle stages based on conditions
    action: auto_transition_engagement_stages
    entity: engagement
    enabled: true
    rule: status == 'active' AND (stage == 'info_gathering' OR stage == 'commencement')
    tracking_field: transition_attempts
    config:
      max_attempts: 3
      stages:
        info_gathering:
          condition: commencement_date <= now()
          target: commencement
          validation:
          - hasBasicInfo
        commencement:
          condition: all_rfis_completed
          target: team_execution
          validation:
          - hasEngagementLetter
          - hasTeam
  - name: rfi_notifications
    trigger: 0 5 * * *
    description: RFI deadline notifications
    action: send_rfi_deadline_notifications
    entity: rfi
    enabled: true
    rule: rfi.notifications.deadline_warnings
    config:
      days_before: $workflows.rfi_type_standard.notifications.deadline_warnings
  - name: rfi_escalation
    trigger: 0 5 * * *
    description: RFI escalation notifications for outstanding RFIs (3, 7, 14 days)
    action: send_rfi_escalation_notifications
    entity: rfi
    enabled: true
    rule: client_status != 'completed' AND status != 'completed' AND engagement.stage
      != 'info_gathering'
    config:
      escalation_thresholds: $workflows.rfi_type_standard.notifications.escalation_thresholds
    tracking_field: escalation_notifications_sent
  - name: consolidated_notifications
    trigger: 0 6 * * *
    description: Daily digest to managers/clerks
    action: send_consolidated_notifications
    entity: notification
    enabled: true
  - name: tender_notifications
    trigger: 0 9 * * *
    description: Tender deadline notifications (7 days and 24 hours)
    action: send_tender_deadline_warnings
    entity: tender
    enabled: true
    rule: tender_status == 'open' AND (daysUntilDeadline <= 7 OR daysUntilDeadline
      == 1)
    config:
      warning_thresholds:
      - 7
      - 1
      - 0
  - name: tender_critical_check
    trigger: 0 * * * *
    description: Hourly check for critical priority tenders
    action: send_critical_tender_alerts
    entity: tender
    enabled: true
    rule: tender_status == 'open' AND priority_level == 'critical'
  - name: tender_auto_close
    trigger: 0 10 * * *
    description: Auto-close tenders when deadline passes
    action: auto_close_expired_tenders
    entity: tender
    enabled: true
    rule: tender_status == 'open' AND deadline < now()
    auto_status_change: closed
  - name: daily_collaborator_expiry_notifications
    trigger: 0 7 * * *
    description: Send 7-day expiry warnings to collaborators
    action: send_collaborator_expiry_notifications
    entity: collaborator
    enabled: true
    rule: expires_at == now() + (7 * 86400) AND notified_at IS NULL
    config:
      days_before_expiry: 7
  - name: temp_access_cleanup
    trigger: 0 0 * * *
    description: Remove expired collaborators
    action: revoke_expired_collaborators
    entity: collaborator
    enabled: true
    rule: access_type == 'temporary' AND expires_at <= now()
  - name: weekly_checklist_pdfs
    trigger: 0 8 * * 1
    description: Weekly checklist PDF reports
    action: generate_weekly_checklist_pdfs
    entity: checklist
    enabled: true
    recipients:
    - role: partner
    - status: active
  - name: weekly_client_emails
    trigger: 0 9 * * 1
    description: Weekly client engagement summaries
    action: send_weekly_client_summaries
    entity: client
    enabled: true
    config:
      include_individual: true
      include_admin_master: true
  - name: engagement_recreation_yearly
    trigger: 0 0 1 1 *
    description: Yearly engagement recreation (Jan 1 @ midnight)
    action: recreate_engagement
    entity: engagement
    enabled: true
    filter: engagement.repeat_interval == 'yearly' AND status == 'active'
  - name: engagement_recreation_monthly
    trigger: 0 0 1 * *
    description: Monthly engagement recreation (1st of month @ midnight)
    action: recreate_engagement
    entity: engagement
    enabled: true
    filter: engagement.repeat_interval == 'monthly' AND status == 'active'
  - name: email_queue_processing
    trigger: 0 * * * *
    description: Process email queue (hourly)
    action: send_queued_emails
    entity: email
    enabled: true
  - name: email_auto_allocation
    trigger: 15 * * * *
    description: Auto-allocate unallocated emails to engagements/RFIs
    action: auto_allocate_emails
    entity: email
    enabled: true
    filter: allocated == false AND status == 'pending'
    config:
      min_confidence: 70
      batch_size: 50
      patterns:
        engagement:
        - engagement[:\s#-]*([a-zA-Z0-9_-]+)
        - eng[:\s#-]*([a-zA-Z0-9_-]+)
        - \[ENG[:\s#-]*([a-zA-Z0-9_-]+)\]
        - re[:\s]*engagement[:\s]*([a-zA-Z0-9_-]+)
        - client[:\s]*([a-zA-Z0-9_-]+)[:\s]*engagement
        rfi:
        - rfi[:\s#-]*([a-zA-Z0-9_-]+)
        - \[RFI[:\s#-]*([a-zA-Z0-9_-]+)\]
        - request[:\s]*for[:\s]*information[:\s#-]*([a-zA-Z0-9_-]+)
        - information[:\s]*request[:\s#-]*([a-zA-Z0-9_-]+)
notifications:
  rfi_escalation:
    description: RFI outstanding escalation notifications
    trigger: rfi.daysOutstanding reaches threshold
    thresholds: $workflows.rfi_type_standard.notifications.escalation_thresholds
    recipients:
    - role: partner
      channels:
      - email
      - in_app
    - role: manager
      channels:
      - email
      - in_app
    template: rfi_escalation_{{threshold}}_days
    enabled: true
    batch: false
  rfi_deadline_warning:
    description: RFI deadline warning notifications
    trigger: rfi.deadline approaching
    thresholds: $workflows.rfi_type_standard.notifications.deadline_warnings
    recipients:
    - role: partner
      channels:
      - email
    - role: manager
      channels:
      - email
    - assigned_users: null
      channels:
      - email
      - in_app
    template: rfi_deadline_{{days}}_days
    enabled: true
    batch: true
  engagement_deadline:
    description: Engagement commencement date reached
    trigger: engagement.commencement_date reached
    recipients:
    - roles:
      - partner
      - manager
      channels:
      - email
    template: engagement_auto_transition
    enabled: true
  collaborator_expiry_7day_warning:
    description: Collaborator access expiring in 7 days
    trigger: collaborator.expires_at - 7d
    recipients:
    - entity: collaborator.user
      channels:
      - email
    template: collaborator_expiry_7day_warning
    enabled: true
    variables:
    - collaborator_name
    - review_name
    - expires_date
  collaborator_expired:
    description: Collaborator access has expired
    trigger: collaborator.expires_at reached
    recipients:
    - entity: collaborator.user
      channels:
      - email
    template: collaborator_access_expired
    enabled: true
  client_feedback_ready:
    description: Engagement ready for client feedback
    trigger: engagement.stage == 'finalization'
    recipients:
    - role: client_admin
      channels:
      - email
    template: client_feedback_ready
    enabled: true
  tender_deadline_warning:
    description: Tender deadline approaching (7 days)
    trigger: tender.daysUntilDeadline <= 7
    recipients:
    - role: partner
      channels:
      - email
      - in_app
    - role: manager
      channels:
      - email
      - in_app
    template: tender_deadline_warning_7_days
    enabled: true
  tender_deadline_24h:
    description: Tender deadline within 24 hours
    trigger: tender.daysUntilDeadline == 1
    recipients:
    - role: partner
      channels:
      - email
      - in_app
    - role: manager
      channels:
      - email
      - in_app
    template: tender_deadline_24h
    enabled: true
  tender_deadline_today:
    description: Tender deadline is today
    trigger: tender.daysUntilDeadline == 0
    recipients:
    - role: partner
      channels:
      - email
      - in_app
    - role: manager
      channels:
      - email
      - in_app
    template: tender_deadline_today
    enabled: true
  tender_created:
    description: New tender created
    trigger: tender.onCreate
    recipients:
    - role: partner
      channels:
      - in_app
    - role: manager
      channels:
      - in_app
    template: tender_created
    enabled: true
  tender_closed:
    description: Tender closed (deadline passed)
    trigger: tender.onStatusChange(closed)
    recipients:
    - role: partner
      channels:
      - email
      - in_app
    - role: manager
      channels:
      - in_app
    template: tender_closed
    enabled: true
  tender_awarded:
    description: Tender awarded
    trigger: tender.onStatusChange(awarded)
    recipients:
    - role: partner
      channels:
      - email
      - in_app
    - role: manager
      channels:
      - email
      - in_app
    template: tender_awarded
    enabled: true
  tender_critical:
    description: Critical priority tender alert
    trigger: tender.onCreate AND tender.priority_level == 'critical'
    recipients:
    - role: partner
      channels:
      - email
      - in_app
    template: tender_critical_alert
    enabled: true
    immediate: true
  engagement_created:
    description: New engagement created
    trigger: engagement.onCreate
    recipients:
    - entity: assigned_to
      channels:
      - in_app
    template: engagement_created
    enabled: true
  engagement_status_changed:
    description: Engagement status changed
    trigger: engagement.onStatusChange
    recipients:
    - entity: assigned_to
      channels:
      - in_app
    template: engagement_status_changed
    enabled: true

  rfi_response_submitted_client:
    description: "Client submitted RFI response - notify auditor"
    trigger: "rfi_response.onCreate AND response_type == 'client_response'"
    recipients:
      - role: partner
        channels:
          - email
          - in_app
      - role: manager
        channels:
          - email
          - in_app
      - entity: rfi.assigned_to
        channels:
          - email
          - in_app
    template: "rfi_response_submitted_client"
    enabled: true
    include_response_text: true

  rfi_response_submitted_auditor:
    description: "Auditor submitted response - notify client"
    trigger: "rfi_response.onCreate AND response_type == 'auditor_response'"
    recipients:
      - role: client_admin
        channels:
          - email
      - entity: rfi.client_user
        channels:
          - email
    template: "rfi_response_submitted_auditor"
    enabled: true
    include_response_text: true

  rfi_response_rejected:
    description: "Response rejected - notify submitter"
    trigger: "rfi_response.onStatusChange(rejected)"
    recipients:
      - entity: responder_id
        channels:
          - email
          - in_app
    template: "rfi_response_rejected"
    enabled: true
    include_rejection_reason: true
    include_rfi_link: true

  rfi_response_accepted:
    description: "Response accepted - notify all parties"
    trigger: "rfi_response.onStatusChange(accepted)"
    recipients:
      - entity: responder_id
        channels:
          - email
          - in_app
      - role: partner
        channels:
          - in_app
      - role: manager
        channels:
          - in_app
    template: "rfi_response_accepted"
    enabled: true

  rfi_response_clarification_needed:
    description: "Response needs clarification"
    trigger: "rfi_response.clarification_needed == true"
    recipients:
      - entity: responder_id
        channels:
          - email
          - in_app
      - role: client_admin
        if: response_type == 'client_response'
        channels:
          - email
    template: "rfi_response_clarification_needed"
    enabled: true
document_generation:
  templates:
    engagement_letter:
      description: Standard engagement letter template
      variables:
        client: client.name
        client_address: client.address
        client_email: client.email
        year: engagement.year
        engagement: engagement.name
        engagement_title: engagement.title
        period: engagement.period
        date: now()
        fee: engagement.fee
        scope: engagement.scope
        partner_name: user.name
        partner_email: user.email
        commencement_date: engagement.commencement_date
        completion_date: engagement.end_date
      google_drive:
        template_folder_env: DRIVE_ENGAGEMENT_LETTER_FOLDER
        output_type: pdf
        cleanup_intermediate_docs: true
        share_with_client: true
  google_drive:
    enabled: true
    template_folder_variable: DRIVE_ENGAGEMENT_LETTER_FOLDER
    output_type: pdf
    cleanup_intermediate_docs: true
    default_sharing:
    - role: reader
      type: user
      emailMessage: Engagement letter for your review
highlights:
  palette:
  - color: '#B0B0B0'
    name: grey
    status: unresolved
    label: Unresolved
    description: Unresolved / Open highlight
    default: true
    order: 1
  - color: '#44BBA4'
    name: green
    status: resolved
    label: Resolved
    description: Resolved highlight
    order: 2
  - color: '#FF4141'
    name: red
    status: high_priority
    label: High Priority
    description: Partner/High Priority Note
    order: 3
  - color: '#7F7EFF'
    name: purple
    status: active_focus
    label: Active Focus
    description: Scrolled To (active focus state)
    order: 4
    system_only: true
  rendering:
    opacity: 0.3
    opacity_hover: 0.5
    opacity_active: 0.7
    border_width: 2
    z_index: 100
    animation_duration_ms: 200
