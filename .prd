{
  "project": "moonlanding",
  "created": "2026-02-24",
  "objective": "Comprehensive styling and UX improvements across all 26 page renderers. Apply unified spacing-system.js, improve form/button/card patterns, fix authentication, and verify all pages render correctly with real browser automation.",
  "phases": {
    "phase_1_audit": "Single comprehensive audit of all renderers to identify styling gaps and inconsistencies",
    "phase_2_refactor": "4 parallel refactoring streams: reviews (7 files), engagements/clients (3 files), RFI/tender (4 files), settings/dialogs/dashboard (8 files)",
    "phase_3_auth_testing": "Fix authentication blocker and prepare browser testing infrastructure",
    "phase_4_verification": "End-to-end browser automation testing of all pages",
    "phase_5_completion": "Final commit and push"
  },
  "items": [
    {
      "id": "1-audit",
      "subject": "Audit all 26 renderers and create styling gap analysis",
      "status": "pending",
      "description": "Read all 26 renderer files in src/ui/, analyze current styling (inline vs spacing-system usage), identify gaps, categorize by type (form inputs, buttons, cards, tables, navigation, empty states, accessibility). Create detailed gap report.",
      "category": "audit",
      "effort": "medium",
      "blocking": ["2-reviews", "3-engagement", "4-rfi", "5-settings"],
      "blockedBy": [],
      "renderers": [
        "review-detail-renderer.js",
        "review-edit-renderer.js",
        "review-renderer.js",
        "review-analytics-renderer.js",
        "review-comparison-renderer.js",
        "batch-review-renderer.js",
        "highlight-threading-renderer.js",
        "engagement-detail-renderer.js",
        "engagement-grid-renderer.js",
        "client-renderer.js",
        "client-progress-renderer.js",
        "rfi-renderer.js",
        "rfi-list-renderer.js",
        "rfi-detail-renderer.js",
        "section-resolution-renderer.js",
        "tender-dashboard-renderer.js",
        "checklist-renderer.js",
        "job-management-renderer.js",
        "letter-workflow-renderer.js",
        "dashboard-renderer.js",
        "advanced-search-renderer.js",
        "settings-renderer.js",
        "settings-user-team-renderer.js",
        "perf-renderer.js",
        "monitoring-dashboard.js",
        "pdf-viewer-renderer.js",
        "entity-renderer.js"
      ],
      "acceptance": [
        "All 26 files analyzed",
        "Styling patterns documented (inline vs spacing-system)",
        "UX gaps identified (form labels, button consistency, spacing, empty states)",
        "Accessibility issues noted (color contrast, focus states, ARIA)",
        "Gap report written to .prd notes"
      ],
      "notes": "This audit unblocks all refactoring tasks. Analyze: inconsistent spacing values, missing form labels, button size/color variations, table padding, card borders, responsive breakpoints, empty state messaging."
    },
    {
      "id": "2-reviews",
      "subject": "Refactor review renderers with spacing-system and UX improvements",
      "status": "pending",
      "description": "Apply spacing-system.js to 7 review-related renderers: review-detail, review-edit, review-renderer, review-analytics, review-comparison, batch-review, highlight-threading. Replace inline styles with SPACING constants, improve form labels, button consistency, table spacing, empty states, progress indicators.",
      "category": "refactor",
      "effort": "large",
      "blocking": ["6-auth"],
      "blockedBy": ["1-audit"],
      "files": [
        "src/ui/review-detail-renderer.js",
        "src/ui/review-edit-renderer.js",
        "src/ui/review-renderer.js",
        "src/ui/review-analytics-renderer.js",
        "src/ui/review-comparison-renderer.js",
        "src/ui/batch-review-renderer.js",
        "src/ui/highlight-threading-renderer.js"
      ],
      "acceptance": [
        "All 7 files use spacing-system.js SPACING constants",
        "Form labels properly styled (uppercase, muted color, bottom margin)",
        "Button styles consistent (size, padding, color variants)",
        "Table spacing standardized (row height, cell padding)",
        "Card headers use renderCardHeader helper",
        "Empty states use renderEmptyState helper",
        "Progress indicators properly styled with color variants",
        "No inline style attributes beyond what spacing-system provides"
      ],
      "edge_cases": [
        "Long review titles (>100 chars) - ensure text wrapping",
        "Many highlights (>1000) - table should handle pagination",
        "Very small screens - buttons/forms remain readable",
        "No highlights/collaborators/checklists - empty states visible"
      ]
    },
    {
      "id": "3-engagement",
      "subject": "Refactor engagement and client renderers with spacing-system",
      "status": "pending",
      "description": "Apply spacing-system.js to 3 engagement/client renderers: engagement-detail, engagement-grid, client-renderer, client-progress-renderer. Standardize grid layouts, card spacing, progress bars, status badges.",
      "category": "refactor",
      "effort": "medium",
      "blocking": ["6-auth"],
      "blockedBy": ["1-audit"],
      "files": [
        "src/ui/engagement-detail-renderer.js",
        "src/ui/engagement-grid-renderer.js",
        "src/ui/client-renderer.js",
        "src/ui/client-progress-renderer.js"
      ],
      "acceptance": [
        "All files import SPACING and spacing helpers",
        "Grid layouts use renderCardGrid helper",
        "Status badges consistent (colors, sizes, placement)",
        "Progress bars use renderProgress helper",
        "Card padding standardized to SPACING constants",
        "Empty states properly styled",
        "Responsive column counts"
      ],
      "edge_cases": [
        "100+ engagements in list - grid paging/virtualization",
        "Client names with special characters",
        "Missing client/engagement data fields"
      ]
    },
    {
      "id": "4-rfi",
      "subject": "Refactor RFI, tender, and section renderers",
      "status": "pending",
      "description": "Apply spacing-system.js to 4 renderers: rfi-renderer, rfi-list, rfi-detail, section-resolution, tender-dashboard. Improve form layouts, question/response styling, deadline displays, progress tracking.",
      "category": "refactor",
      "effort": "medium",
      "blocking": ["6-auth"],
      "blockedBy": ["1-audit"],
      "files": [
        "src/ui/rfi-renderer.js",
        "src/ui/rfi-list-renderer.js",
        "src/ui/rfi-detail-renderer.js",
        "src/ui/section-resolution-renderer.js",
        "src/ui/tender-dashboard-renderer.js"
      ],
      "acceptance": [
        "All files use SPACING constants for layout",
        "Form inputs have proper labels (uppercase, muted color)",
        "Question/response pairs use consistent spacing",
        "Deadline badges styled (color coded by urgency)",
        "Progress indicators on RFI pages",
        "Section tables properly spaced",
        "Empty state messaging visible"
      ],
      "edge_cases": [
        "RFI with 50+ questions - table pagination",
        "Long response text - text wrapping in tables",
        "Overdue RFIs - highlighting/styling"
      ]
    },
    {
      "id": "5-settings",
      "subject": "Refactor settings, dialogs, dashboards with spacing-system",
      "status": "pending",
      "description": "Apply spacing-system.js to 8 renderers: settings, settings-user-team, dashboard, monitoring-dashboard, advanced-search, checklist, job-management, letter-workflow, pdf-viewer, perf-renderer. Standardize form layouts, dialog styling, navigation, accessibility.",
      "category": "refactor",
      "effort": "large",
      "blocking": ["6-auth"],
      "blockedBy": ["1-audit"],
      "files": [
        "src/ui/settings-renderer.js",
        "src/ui/settings-user-team-renderer.js",
        "src/ui/dashboard-renderer.js",
        "src/ui/monitoring-dashboard.js",
        "src/ui/advanced-search-renderer.js",
        "src/ui/checklist-renderer.js",
        "src/ui/job-management-renderer.js",
        "src/ui/letter-workflow-renderer.js",
        "src/ui/pdf-viewer-renderer.js",
        "src/ui/perf-renderer.js",
        "src/ui/entity-renderer.js"
      ],
      "acceptance": [
        "All files import and use SPACING constants",
        "Form groups have consistent label/input spacing",
        "Dialogs use proper padding (SPACING.lg)",
        "Settings sections separated by SPACING.xl",
        "Navigation tabs use renderTabBar helper",
        "Dashboard grid layouts use renderCardGrid",
        "Monitoring dashboard metrics properly spaced",
        "Search inputs have proper labels and placeholders",
        "PDF viewer toolbar spacing standardized"
      ],
      "edge_cases": [
        "Settings pages with many fields (>20) - form grouping",
        "Dashboard with limited horizontal space - responsive columns",
        "PDF viewer on mobile - touch targets large enough",
        "Monitoring data unavailable - empty state display"
      ]
    },
    {
      "id": "6-auth",
      "subject": "Fix authentication system to enable browser testing",
      "status": "pending",
      "description": "Root cause analysis and fix of authentication broken state (login API returns 401 despite correct password hash). Investigate: getBy() function, request body parsing, database connection, session creation. Verify login works with test credentials.",
      "category": "bug",
      "effort": "large",
      "blocking": ["7-testing"],
      "blockedBy": ["2-reviews", "3-engagement", "4-rfi", "5-settings"],
      "acceptance": [
        "Login API POST /api/auth/login returns 200 with correct credentials",
        "Session cookie set correctly (HttpOnly, SameSite=Lax)",
        "Test user (admin@coas.co.za / Test123456) logs in successfully",
        "Authenticated requests include valid session cookie",
        "Logout clears session cookie",
        "Rate limiting still enforced (5 attempts/15 min)"
      ],
      "edge_cases": [
        "Invalid email - 401 response",
        "Wrong password - 401 response",
        "Rate limited after 5 attempts - 429 response",
        "Lockout window after 15 min - lock expires correctly"
      ],
      "notes": "Previous investigation: password hash was corrected but API still returns 401. Possible issues: getBy() function not finding user in database, request body not parsed correctly before reaching handler, database connection issue, or Lucia session creation failure. Check server logs for error messages."
    },
    {
      "id": "7-testing",
      "subject": "Execute comprehensive browser automation testing of all pages",
      "status": "pending",
      "description": "Use agent-browser skill to navigate all pages and verify styling/UX improvements are visible and functional. Test: login flow, page navigation, form inputs, buttons, table interactions, responsive behavior, empty states, accessibility (keyboard navigation).",
      "category": "testing",
      "effort": "large",
      "blocking": ["8-commit"],
      "blockedBy": ["6-auth"],
      "test_pages": [
        "/",
        "/login",
        "/dashboard",
        "/review",
        "/review/:id",
        "/review/:id/pdf",
        "/review/:id/highlights",
        "/review/:id/sections",
        "/review/:id/resolution",
        "/review/:id/edit",
        "/engagement",
        "/engagement/:id",
        "/client",
        "/rfi",
        "/rfi/:id",
        "/checklist/:id",
        "/settings",
        "/settings/users",
        "/monitoring",
        "/job-management"
      ],
      "acceptance": [
        "All 20+ pages load and render without JavaScript errors",
        "Navigation between pages works",
        "Forms accept input and submit",
        "Buttons have proper hover/active states",
        "Tables display data correctly with proper spacing",
        "Empty states display when no data present",
        "Responsive breakpoints work (test at 320px, 768px, 1200px)",
        "Keyboard navigation works (Tab, Enter, Escape)",
        "Color contrast meets WCAG AA standards (automated check if possible)",
        "No console errors or warnings"
      ],
      "edge_cases": [
        "Very long text - verify wrapping and truncation",
        "Many rows in table - pagination/virtualization works",
        "Form validation - error messages display",
        "File uploads - progress and completion",
        "Real-time data updates - live changes reflected"
      ]
    },
    {
      "id": "8-commit",
      "subject": "Commit and push all styling improvements",
      "status": "pending",
      "description": "Stage all modified renderer files and spacing-system.js. Create comprehensive commit message covering: spacing-system application, UX improvements per category, authentication fix, browser testing results. Push to remote repository.",
      "category": "infrastructure",
      "effort": "small",
      "blocking": [],
      "blockedBy": ["7-testing"],
      "acceptance": [
        "All modified files staged (git add)",
        "Commit message references all 26 renderers",
        "Commit message explains spacing-system migration",
        "Commit includes auth fix details",
        "Changes pushed to remote (git push)",
        "Remote repository reflects all changes",
        "No uncommitted changes remain (git status clean)"
      ],
      "notes": "Use conventional commit format. Include references to spacing-system.js, affected page categories, authentication fix, and test results."
    }
  ],
  "completed": [],
  "metadata": {
    "total_items": 8,
    "total_renderers": 26,
    "estimated_duration": "6-8 hours",
    "parallel_waves": 5,
    "max_per_wave": 3,
    "key_blockers": [
      "Authentication system must be fixed before browser testing",
      "Audit must complete before refactoring tasks can proceed"
    ]
  }
}
