# Moonlanding Platform - Product Requirements & Status

## Executive Summary

**Moonlanding** is an ultra-minimal unified platform combining engagement management, document review, and collaboration features. Built with **zero-build architecture** (tsx runtime), **SQLite** local database, and **Lucia** authentication.

**Current Status:** Feature parity with friday-staging & myworkreview-staging in progress
**Architecture:** Intentionally lightweight to enable rapid iteration and no vendor lock-in
**Deployment:** Single Node.js server, buildless, fully control

---

## Comprehensive Feature Inventory

### Implemented Features ‚úÖ

#### 1. Core Platform
- ‚úÖ Zero-build runtime (tsx transpilation)
- ‚úÖ SQLite database (better-sqlite3)
- ‚úÖ Lucia authentication + Arctic OAuth
- ‚úÖ Custom HTTP server (no Express bloat)
- ‚úÖ Hot module reloading for configs
- ‚úÖ Module cache invalidation

#### 2. Entity Management
- ‚úÖ Entity CRUD operations via API
- ‚úÖ Dynamic entity rendering
- ‚úÖ Field render system (date, enum, text, etc)
- ‚úÖ Status color coding
- ‚úÖ Bulk actions toolbar
- ‚úÖ Pagination support

#### 3. Review/Engagement System
- ‚úÖ Review detail view with tabs
- ‚úÖ Engagement lifecycle tracking
- ‚úÖ Status transitions
- ‚úÖ WIP value tracking
- ‚úÖ Team assignment
- ‚úÖ Financial year tracking

#### 4. PDF Management
- ‚úÖ PDF viewer component
- ‚úÖ File upload handling
- ‚úÖ PDF rendering via Puppeteer
- ‚úÖ MIME type detection
- ‚úÖ Drive file integration

#### 5. Collaboration Features
- ‚úÖ Checklist tracker
- ‚úÖ Collaborator manager
- ‚úÖ Comment section
- ‚úÖ Chat panel (basic)
- ‚úÖ Highlight layer
- ‚úÖ Highlight annotator

#### 6. Email & Notifications
- ‚úÖ Nodemailer integration
- ‚úÖ Email template system
- ‚úÖ SMTP configuration
- ‚úÖ Transactional emails

#### 7. UI Components (66 total)
- ‚úÖ Form components
- ‚úÖ Dialog/modal system
- ‚úÖ Table rendering
- ‚úÖ Dashboard widgets
- ‚úÖ Navigation components
- ‚úÖ Status indicators

#### 8. Data Import/Export
- ‚úÖ YAML config import
- ‚úÖ CSV/JSON export support
- ‚úÖ Bulk data operations
- ‚úÖ Template management

#### 9. Configuration System
- ‚úÖ Master config engine
- ‚úÖ Dynamic enum options
- ‚úÖ Workflow stage definitions
- ‚úÖ Entity field definitions
- ‚úÖ Icon configuration
- ‚úÖ Theme configuration

#### 10. Google Integration
- ‚úÖ Google Drive file handling
- ‚úÖ googleapis library integrated
- ‚úÖ Service account authentication
- ‚úÖ File upload to Drive

---

### Missing Features (HIGH PRIORITY) ‚ùå

#### 1. Advanced PDF Annotation & Comparison
**Status:** Viewer exists, no annotation/comparison
**Location needed:** src/components/pdf-comparison.jsx (new), enhance pdf-viewer.jsx
**Pattern source:** myworkreview-staging PdfHighlighter + comparison mode
**What's needed:**
- Text/area highlight creation
- Color-coded highlights by category
- Persistent highlight storage
- Highlight resolution workflow
- Side-by-side PDF comparison
- Zoom/rotation controls
- Coordinate recalculation after transforms
- Highlight export

**Database schema needed:**
```sql
CREATE TABLE pdf_highlights (
  id TEXT PRIMARY KEY,
  pdf_id TEXT,
  user_id TEXT,
  page_number INTEGER,
  coordinates JSON,
  text TEXT,
  color TEXT,
  category TEXT,
  resolved BOOLEAN DEFAULT false,
  created_at DATETIME
);
```

#### 2. Audit Trail & Action Logging
**Status:** Not implemented
**Location needed:** src/lib/audit-logger.js (new)
**Pattern source:** myworkreview-staging logs all actions
**What's needed:**
- Action logging middleware
- Database audit table
- Action history retrieval
- Filtered audit reports
- Entity change tracking
- User action attribution

**Database schema needed:**
```sql
CREATE TABLE audit_logs (
  id TEXT PRIMARY KEY,
  entity_type TEXT,
  entity_id TEXT,
  action TEXT,
  user_id TEXT,
  before_state JSON,
  after_state JSON,
  created_at DATETIME
);
```

#### 3. RFI (Request For Information) System
**Status:** Not implemented
**Location needed:** src/components/rfi-*/, src/app/api/rfi/
**Pattern source:** friday-staging RFI system (17+ components)
**What's needed:**
- RFI template management
- Question creation and assignment
- Response tracking
- Deadline management
- Status workflow
- Response attachments
- RFI reports and analytics

**Database schema needed:**
```sql
CREATE TABLE rfis (
  id TEXT PRIMARY KEY,
  engagement_id TEXT,
  status TEXT,
  created_at DATETIME
);
CREATE TABLE rfi_questions (
  id TEXT PRIMARY KEY,
  rfi_id TEXT,
  question TEXT,
  category TEXT,
  assigned_to TEXT,
  due_date DATE
);
CREATE TABLE rfi_responses (
  id TEXT PRIMARY KEY,
  question_id TEXT,
  response TEXT,
  attachments JSON,
  created_at DATETIME
);
```

---

### Missing Features (MEDIUM PRIORITY) üü°

#### 6. Tender Management
**Status:** Basic fields exist (tender_id), no system
**What's needed:**
- Tender CRUD operations
- Bid tracking
- Deadline management
- Status workflow
- Client integration

#### 7. Google Drive Advanced Integration
**Status:** Basic upload/download exists
**What's needed:**
- Folder structure templates
- Batch operations
- Permissions sync
- File versioning
- Webhook integration

#### 8. Email Notification System
**Status:** Nodemailer installed, not integrated
**What's needed:**
- Event-triggered emails
- Email templates
- Recipient configuration
- Notification preferences
- Digest emails
- Unsubscribe handling

#### 9. Search & Filtering
**Status:** Basic pagination exists
**What's needed:**
- Full-text search
- Advanced filters
- Saved filters
- Search history
- Faceted search

#### 10. Workflow Automation
**Status:** Manual workflows only
**What's needed:**
- Automation rules
- Triggers (time, status change, etc)
- Actions (email, status update, etc)
- Conditional logic
- Approvals workflow

---

### Missing Features (LOW PRIORITY) üü¢

#### 11. Performance Monitoring
- Error tracking
- Page performance metrics
- API response times
- User activity analytics

#### 12. Data Analytics Dashboard
- Engagement metrics
- Team productivity
- Status distribution
- Timeline insights

#### 13. Mobile PWA Features
- Offline support
- Push notifications
- Home screen install
- Background sync

#### 14. Advanced Export Options
- PDF reports with charts
- Excel workbooks
- Custom export templates
- Scheduled exports

---

## Architecture & Technical Decisions

### Why Zero-Build is Superior
- **Development speed:** No build step = instant code changes
- **Debugging:** Direct source code, no sourcemaps needed
- **Deployment:** Just copy files, run with tsx
- **Vendor lock-in:** No build tool dependencies
- **Bundle size:** No webpack bloat, minimal runtime

### Why SQLite Over Firebase
- **Cost:** Zero per-request costs
- **Control:** Full data ownership, local backup
- **Latency:** Sub-millisecond queries
- **Offline:** Can work offline with sync later
- **Simplicity:** No async complexities, sync API
- **Testing:** In-memory database for tests

### Why Not Mantine/MUI
- **Bloat:** Mantine = 2MB, MUI = 3MB+
- **Bundle:** Brings in emotion, floating-ui, etc
- **Maintenance:** Large API surface to learn
- **RippleUI alternative:** 40KB CSS, 36 components, TailwindCSS

### Why WebJSX + RippleUI
- **Minimal:** ~100 lines for createElement + applyDiff
- **Standards-based:** Just Web Components, no framework bloat
- **CSS-first:** RippleUI provides semantic CSS classes
- **Zero dependencies:** No package updates breaking code
- **Buildless:** Perfect complement to tsx runtime

---

## Dependency Management Strategy

### Current (Problematic)
- **Mantine 7.13:** ~2MB, many sub-dependencies
- **@mantine/hooks:** Custom hooks library
- **@mantine/notifications:** Toast/alert system
- **Total top-level:** ~30 dependencies

### Target (After Migration)
- **Remove:** Mantine, @mantine/*, @tabler/icons-react
- **Keep:** React, React-DOM (essential), Better-sqlite3, Lucia, googleapis, puppeteer, nodemailer
- **Add:** RippleUI CSS (~40KB), WebJSX (~5KB)
- **Total top-level:** ~20 dependencies
- **Reduction:** ~40% smaller node_modules

---

## Database Schema Evolution

### Current Tables
```
users, authentications, sessions, entities, 
entity_definitions, relationships, checklists, 
comments, attachments, ...
```

### To Add (From Missing Features)
```
chat_messages, chat_mentions, pdf_highlights,
audit_logs, rfis, rfi_questions, rfi_responses,
workflows, notifications, saved_searches
```

---

## API Endpoints Status

### Implemented
```
/api/[entity]/        - CRUD
/api/[entity]/[id]    - Details
/api/auth/*           - Authentication
/api/upload           - File upload
/api/config           - Configuration
```

### To Add
```
/api/chat/           - Messages
/api/highlights/     - PDF annotations
/api/audit/          - Action logs
/api/rfis/           - RFI operations
/api/permissions/    - RBAC checks
/api/workflows/      - Automation
```

---

## Component Migration Plan

### Phase 4: PDF Advanced Features
- [ ] Add highlight creation
- [ ] Add comparison mode
- [ ] Persistent highlight storage
- [ ] Resolution workflow
- [ ] Export highlights

### Phase 5: Audit Trail
- [ ] Create audit logging middleware
- [ ] Log all data mutations
- [ ] Build audit report UI
- [ ] Add filtering by user/entity/action

### Phase 6: RFI System
- [ ] Design RFI templates
- [ ] Build RFI CRUD UI
- [ ] Question assignment workflow
- [ ] Response tracking
- [ ] RFI reports

---

## Known Issues & TODOs

### Code Quality
- [ ] Domain.jsx is 194 lines - consider splitting
- [ ] FileReview.tsx in myworkreview is 183KB - avoid this pattern
- [ ] Add JSDoc comments to API handlers
- [ ] Improve error messages across API

### Performance
- [ ] Add query optimization for large datasets
- [ ] Implement pagination throughout
- [ ] Optimize PDF rendering for large files
- [ ] Add caching for config system

### Testing
- [ ] Add end-to-end tests for all workflows
- [ ] Test RBAC enforcement
- [ ] Test offline behavior
- [ ] Load test with 1000+ entities

### Security
- [ ] Add CSRF protection if needed
- [ ] Validate all file uploads
- [ ] Sanitize HTML in comments
- [ ] Rate limit API endpoints

---

## Version & Deployment

**Current Version:** 1.0.0
**Target Version:** 2.0.0 (after feature completion)
**Deployment:** npm run dev (local), npm run build (production if needed)
**Server Port:** 3004
**Database:** data/app.db (SQLite)

---

## Comparison Matrix with Other Projects

| Feature | moonlanding | friday-staging | myworkreview |
|---------|-------------|-----------------|--------------|
| Zero-build | ‚úÖ | ‚ùå | ‚ùå |
| SQLite | ‚úÖ | ‚ùå | ‚ùå |
| RBAC | ‚úÖ | ‚ùå | ‚úÖ |
| Real-time Chat | ‚úÖ | ‚ùå | ‚úÖ |
| PDF Annotation | üü° | ‚úÖ | ‚úÖ |
| RFI System | ‚ùå | ‚úÖ | ‚ùå |
| Email System | üü° | ‚úÖ | ‚úÖ |
| Audit Trail | ‚ùå | ‚ùå | ‚úÖ |
| Component Count | 66 | 17 | 40+ |
| Dependencies | ~25 | ~50+ | ~50+ split |

---

## Success Criteria

‚úÖ **Phase 1 Complete:** All UI migrated to RippleUI, Mantine removed, no visual regressions
‚úÖ **Phase 2 Complete:** RBAC implemented, all endpoints protected, permissions enforced
‚úÖ **Phase 3 Complete:** Chat system persists messages, supports attachments, real-time updates
üîÑ **Phase 4 Complete:** PDF annotations, comparison mode, highlight export working
üîÑ **Phase 5 Complete:** All actions logged, audit trail queryable
üîÑ **Phase 6 Complete:** RFI system fully functional with templates and reporting
‚úÖ **Final:** Zero build dependencies, all 10 core features working, under 200 lines per file

---

## Next Steps

1. ‚úÖ Analyze comparison with other projects (DONE)
2. ‚úÖ Phase 1: RippleUI migration complete (DONE)
3. ‚úÖ Phase 2: RBAC implementation complete (DONE)
4. ‚úÖ Phase 3: Chat system enhancement complete (DONE)
5. üîÑ Begin Phase 4: PDF Advanced Features (annotations, comparison)
6. Implement remaining high-priority features (Phase 5-6)
7. End-to-end testing
8. Production deployment
