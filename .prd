# FEATURE PARITY & DATA MIGRATION PRD
# Complete transformation of Moonlanding to achieve 100% feature parity with Friday-staging + MyWorkReview-staging
# Target: Configuration-driven, RippleUI-based, WebJSX-powered, hot-reloadable, state-synchronized system

## DEPENDENCY GRAPH LEGEND
# [WAVE N] = Parallel execution wave number
# BLOCKS: [item-id, ...] = Items that cannot start until this completes
# BLOCKED_BY: [item-id, ...] = Items that must complete before this starts
# Items in same wave with no dependencies execute in parallel via multiple gm subagents

## WAVE 2: COMPLETED
# All 5 items complete. Outputs: wave-2.1-friday-gap-analysis.json, wave-2.2-mwr-gap-analysis.md, wave-2.3-overlap-analysis.json, wave-2.4-architecture-gaps.json, wave-2.5-rippleui-framework.json

## WAVE 3: COMPLETED
# All 4 items complete. master-config.yml updated with Friday gaps (3.1), MWR gaps (3.2), duplication consolidated (3.3), 12 new WebJSX components created (3.4).

## WAVE 4: COMPLETED
# All 8 items complete. 30 new API endpoints, 18 new UI files, unified implementation (4.5), enhanced hot reload (4.6), WebJSX+RippleUI conversion (4.7+4.8). Commit: 53c0ae2

## WAVE 5: COMPLETED
# All 10 items complete. State sync (5.1), rendering optimization (5.2), error handling (5.3), validation (5.4), testing infrastructure (5.5), DB optimization (5.6), audit logging (5.7), monitoring (5.8), bundle optimization (5.9), accessibility (5.10). Commit: a4a599f

## WAVE 6: DATA MIGRATION EXECUTION (Depends on Wave 5)

[WAVE-6.1] Execute Phase 3.5 - Pilot Migration (10%)
BLOCKS: [WAVE-6.2, WAVE-7.2]
BLOCKED_BY: [WAVE-4.1, WAVE-4.2]
DETAILS:
- Create production database backup
- Extract 10% sample from Friday-staging (1,600-1,700 records)
- Extract 10% sample from MyWorkReview-staging
- Run complete migration pipeline with both samples
- Execute user deduplication (10-15% overlap expected)
- Transform all fields per schema-mapping.json
- Normalize all subcollections to SQLite tables
- Preserve PDF coordinates exactly (±0 pixels - CRITICAL)
- Normalize all timestamps to UTC ISO 8601
- Update all file paths to Moonlanding structure
- Run all 8 validators:
  * Row Count Validator
  * Referential Integrity Validator
  * Data Type Validator
  * PDF Coordinate Validator (±0 pixels)
  * Timestamp Validator (UTC format)
  * File Path Validator
  * JSON Field Validator
  * FK Constraint Validator
- Verify 100% validator pass rate (8/8)
- Generate comprehensive pilot report
- Test rollback capability
- Document any issues found
- Fix any issues found before proceeding
- Get sign-off to proceed to Phase 3.6
- SUCCESS CRITERIA: 8/8 validators pass, 0 data loss, rollback works

[WAVE-6.2] Execute Phase 3.6 - Full Data Migration (100%)
BLOCKS: [WAVE-6.3, WAVE-7.3]
BLOCKED_BY: [WAVE-4.3, WAVE-4.4, WAVE-6.1]
DETAILS:
- Create final production database backup
- Load all Friday-staging data (80K-200K records expected)
- Load all MyWorkReview-staging data (15K-30K records expected)
- Execute user deduplication (expect 10-15% reduction)
- Transform all fields per schema-mapping.json
- Normalize all subcollections
- Preserve PDF coordinates exactly (±0 pixels - CRITICAL)
- Normalize all timestamps to UTC ISO 8601
- Update all file paths
- Run all 8 validators on full dataset
- Verify 100% validator pass rate (8/8)
- Generate comprehensive migration report
- Document any data anomalies found
- Verify total record count: 230K-250K expected
- Verify zero data loss
- SUCCESS CRITERIA: 8/8 validators pass, 230K+ records, 0 data loss

[WAVE-6.3] Execute Phase 3.7 - Data Integrity Verification
BLOCKS: [WAVE-6.4, WAVE-7.4]
BLOCKED_BY: [WAVE-4.5, WAVE-6.2]
DETAILS:
- [7.1] Verify user deduplication accuracy (10-15% overlap)
- [7.2] Verify engagement-client relationships intact
- [7.3] Verify RFI-engagement-question relationships intact
- [7.4] Verify highlight coordinates preserved ±0 pixels (CRITICAL)
- [7.5] Verify timestamps UTC normalized (Z suffix)
- [7.6] Verify file paths updated correctly, files exist
- [7.7] Verify permission relationships intact
- [7.8] Verify activity logs complete
- [7.9] Run full system integration test with real workflows
- [7.10] Spot check 100 random records across entities
- [7.11] Verify no orphaned records (0 orphans)
- [7.12] Verify performance baseline (p95 <500ms @ 100K records)
- Generate comprehensive verification report
- Document any issues found
- Fix any issues found
- Re-run failed checks until all pass
- SUCCESS CRITERIA: 12/12 checks pass

[WAVE-6.4] Execute Phase 3.8 - Parallel Operations Setup
BLOCKS: [WAVE-6.5, WAVE-7.5]
BLOCKED_BY: [WAVE-4.6, WAVE-6.3]
DETAILS:
- [8.1] Set Friday-staging to read-only mode
- [8.2] Set MyWorkReview-staging to read-only mode
- [8.3] Create change sync Friday → Moonlanding
- [8.4] Create change sync MWR → Moonlanding
- [8.5] Set up dual-system routing (old systems → Moonlanding with fallback)
- [8.6] Monitor data consistency between systems
- [8.7] Test rollback from Moonlanding to old systems
- [8.8] Document dual-system operation procedures
- Run parallel operations for 24-48 hours
- Verify no data divergence
- Verify sync latency <1 second
- Verify rollback procedures work
- SUCCESS CRITERIA: Dual systems in sync, rollback tested

[WAVE-6.5] Execute Phase 3.9 - Production Cutover
BLOCKS: [WAVE-6.6, WAVE-7.6]
BLOCKED_BY: [WAVE-6.4]
DETAILS:
- [9.1] Set old systems to read-only (final lock)
- [9.2] Verify no pending changes in old systems
- [9.3] Run final sync old → Moonlanding
- [9.4] Verify all data is current
- [9.5] Switch production traffic to Moonlanding
- [9.6] Verify system operation under load
- [9.7] Monitor for errors (first hour critical)
- [9.8] Decommission old systems (after stability confirmed)
- Keep backups of old systems for 30 days
- Document cutover timestamp
- SUCCESS CRITERIA: 100% traffic on Moonlanding, 0 critical errors

[WAVE-6.6] Execute Phase 3.10 - Post-Migration Support
BLOCKS: [WAVE-7.7]
BLOCKED_BY: [WAVE-6.5]
DETAILS:
- [10.1] Monitor error logs continuously (24 hours)
- [10.2] Address user issues immediately (SLA <15 min)
- [10.3] Optimize performance if p95 >500ms
- [10.4] Create migration documentation
- [10.5] Archive old system data
- [10.6] Update operational runbooks
- [10.7] Train support team on Moonlanding
- Monitor metrics hourly for first 24h
- Monitor metrics daily for first week
- Monitor metrics weekly for first month
- Document lessons learned
- SUCCESS CRITERIA: 24h stable operation, all documentation complete

[WAVE-6.7] Verify zero data loss post-migration
BLOCKS: [WAVE-7.8]
BLOCKED_BY: [WAVE-5.1]
DETAILS:
- Count all records in source systems
- Count all records in Moonlanding
- Account for deduplication (10-15%)
- Verify counts match exactly
- Spot check 1000 random records
- Verify all fields migrated correctly
- Verify all relationships intact
- Verify all files accessible
- Verify all timestamps correct
- Verify all coordinates preserved
- Document any discrepancies
- Fix any discrepancies found
- Re-verify after fixes
- SUCCESS CRITERIA: 0 data loss, 100% accuracy

[WAVE-6.8] Performance benchmarking post-migration
BLOCKS: [WAVE-7.9]
BLOCKED_BY: [WAVE-5.2]
DETAILS:
- Measure p50/p95/p99 latency for all endpoints
- Measure database query performance
- Measure page load times
- Measure time to interactive
- Measure bundle sizes
- Measure memory usage
- Measure CPU usage
- Measure concurrent user capacity
- Compare against baseline (p95 <500ms target)
- Identify performance bottlenecks
- Optimize bottlenecks found
- Re-benchmark after optimizations
- Document performance characteristics
- SUCCESS CRITERIA: p95 <500ms, no degradation from baseline

[WAVE-6.9] Security audit post-migration
BLOCKS: [WAVE-7.10]
BLOCKED_BY: [WAVE-5.3]
DETAILS:
- Verify all endpoints require authentication
- Verify all endpoints enforce authorization
- Verify CSRF protection on all mutating endpoints
- Verify input validation on all endpoints
- Verify output sanitization prevents XSS
- Verify SQL injection prevention
- Verify file upload restrictions
- Verify rate limiting on expensive operations
- Verify session security (httpOnly, secure, sameSite)
- Verify password hashing (bcrypt with cost 12)
- Test common attack vectors
- Document security posture
- Fix any vulnerabilities found
- Re-test after fixes
- SUCCESS CRITERIA: 0 critical vulnerabilities

[WAVE-6.10] Accessibility audit post-migration
BLOCKS: [WAVE-7.11]
BLOCKED_BY: [WAVE-5.4]
DETAILS:
- Test with keyboard navigation only
- Test with screen reader (NVDA/JAWS)
- Test with browser zoom 200%
- Test color contrast ratios
- Test ARIA labels and roles
- Test focus management
- Test form validation feedback
- Test error messages
- Test skip links
- Run automated accessibility scanner
- Document accessibility issues
- Fix all WCAG 2.1 AA violations
- Re-test after fixes
- SUCCESS CRITERIA: WCAG 2.1 AA compliant

[WAVE-6.11] Browser compatibility testing
BLOCKS: [WAVE-7.12]
BLOCKED_BY: [WAVE-5.5]
DETAILS:
- Test on Chrome (latest)
- Test on Firefox (latest)
- Test on Safari (latest)
- Test on Edge (latest)
- Test on mobile Chrome
- Test on mobile Safari
- Test on tablet devices
- Verify all features work correctly
- Verify all layouts render correctly
- Verify all interactions work correctly
- Document browser-specific issues
- Fix critical compatibility issues
- Test fallbacks for unsupported features
- SUCCESS CRITERIA: Works on all major browsers

[WAVE-6.12] Load testing post-migration
BLOCKS: [WAVE-7.13]
BLOCKED_BY: [WAVE-5.6]
DETAILS:
- Simulate 100 concurrent users
- Simulate 1000 concurrent users
- Simulate 10000 concurrent users
- Measure response times under load
- Measure error rates under load
- Measure resource usage under load
- Identify breaking points
- Test database connection limits
- Test memory limits
- Test CPU limits
- Test network bandwidth limits
- Document load characteristics
- Optimize for identified bottlenecks
- Re-test after optimizations
- SUCCESS CRITERIA: Handles expected peak load with p95 <500ms

[WAVE-6.13] Disaster recovery testing
BLOCKS: [WAVE-7.14]
BLOCKED_BY: [WAVE-5.7]
DETAILS:
- Test database backup and restore
- Test server crash recovery
- Test network partition recovery
- Test data corruption recovery
- Test rollback to previous version
- Test hot reload recovery
- Test checkpoint/restore mechanisms
- Measure recovery time objectives (RTO)
- Measure recovery point objectives (RPO)
- Document recovery procedures
- Train team on recovery procedures
- SUCCESS CRITERIA: RTO <15 min, RPO <5 min

[WAVE-6.14] Documentation completeness audit
BLOCKS: [WAVE-7.15]
BLOCKED_BY: [WAVE-5.8]
DETAILS:
- Document all API endpoints
- Document all configuration options
- Document all deployment procedures
- Document all monitoring setup
- Document all troubleshooting procedures
- Document all architecture decisions
- Document all security considerations
- Document all performance optimizations
- Document all accessibility features
- Document all testing procedures
- Create user guides
- Create admin guides
- Create developer guides
- SUCCESS CRITERIA: Complete documentation for all areas

[WAVE-6.15] User acceptance testing
BLOCKS: [WAVE-7.16]
BLOCKED_BY: [WAVE-5.9]
DETAILS:
- Test all critical user workflows
- Test engagement creation workflow
- Test RFI submission workflow
- Test review completion workflow
- Test highlight annotation workflow
- Test collaborative features
- Test search and filter
- Test bulk operations
- Test mobile workflows
- Get user feedback on usability
- Document user issues
- Fix critical user issues
- Re-test after fixes
- SUCCESS CRITERIA: All critical workflows work, user acceptance achieved

[WAVE-6.16] Final system health check
BLOCKS: [WAVE-7.17]
BLOCKED_BY: [WAVE-5.10]
DETAILS:
- Verify all services running
- Verify all databases accessible
- Verify all external integrations working
- Verify all cron jobs executing
- Verify all email notifications sending
- Verify all file uploads/downloads working
- Verify all PDF generation working
- Verify all exports working
- Verify all imports working
- Verify all audit logging working
- Verify all monitoring working
- Verify all alerting working
- Verify all hot reload working
- Verify all error recovery working
- Document system health status
- SUCCESS CRITERIA: 100% health across all systems

## WAVE 7: VALIDATION & CLEANUP (Final wave, depends on Wave 6)

[WAVE-7.1] Validate all features match Friday-staging exactly
BLOCKS: []
BLOCKED_BY: [WAVE-5.1, WAVE-6.1]
DETAILS:
- Create feature checklist from Friday-staging analysis
- Test each feature in Moonlanding
- Verify functionality matches exactly
- Verify UI/UX matches
- Verify performance matches or exceeds
- Document any differences
- Fix critical differences
- Accept minor improvements
- Get stakeholder sign-off on feature parity
- SUCCESS CRITERIA: 100% feature parity with Friday

[WAVE-7.2] Validate all features match MyWorkReview-staging exactly
BLOCKS: []
BLOCKED_BY: [WAVE-6.1, WAVE-6.2]
DETAILS:
- Create feature checklist from MWR-staging analysis
- Test each feature in Moonlanding
- Verify functionality matches exactly
- Verify UI/UX matches
- Verify performance matches or exceeds
- Document any differences
- Fix critical differences
- Accept minor improvements
- Get stakeholder sign-off on feature parity
- SUCCESS CRITERIA: 100% feature parity with MWR

[WAVE-7.3] Validate RippleUI usage is 100% complete
BLOCKS: []
BLOCKED_BY: [WAVE-6.2, WAVE-6.3]
DETAILS:
- Audit all UI files for RippleUI class usage
- Verify 176/176 files use RippleUI classes
- Remove any custom CSS that duplicates RippleUI
- Ensure consistent styling across all pages
- Verify responsive behavior across all breakpoints
- Document RippleUI patterns used
- SUCCESS CRITERIA: 100% RippleUI coverage, 0 duplicate CSS

[WAVE-7.4] Validate WebJSX usage is 100% complete
BLOCKS: []
BLOCKED_BY: [WAVE-6.3, WAVE-6.4]
DETAILS:
- Audit all UI files for WebJSX usage
- Verify all UI files use WebJSX (no template strings)
- Verify all JSX hot-reloads correctly
- Verify all components are modular
- Verify all components have prop validation
- Document WebJSX patterns used
- SUCCESS CRITERIA: 100% WebJSX coverage, 0 template strings

[WAVE-7.5] Validate hot reload is flawless across all modules
BLOCKS: []
BLOCKED_BY: [WAVE-6.4, WAVE-6.5]
DETAILS:
- Test hot reload on all route files
- Test hot reload on all UI components
- Test hot reload on all configuration files
- Test hot reload on all service files
- Test hot reload on all engine files
- Verify no state loss during reload
- Verify no dropped requests during reload
- Verify reload latency <100ms
- Test reload under load
- Test reload with errors
- Document hot reload coverage
- SUCCESS CRITERIA: 100% hot reload coverage, 0 state loss, 0 dropped requests

[WAVE-7.6] Validate client-server state sync is predictable
BLOCKS: []
BLOCKED_BY: [WAVE-6.5, WAVE-6.6]
DETAILS:
- Test state sync with single user
- Test state sync with multiple concurrent users
- Test state sync with network delays
- Test state sync with network failures
- Test state sync with rapid updates
- Test state sync with large state objects
- Verify no race conditions
- Verify no state corruption
- Verify optimistic updates rollback correctly
- Verify conflict resolution works correctly
- Document state sync behavior
- SUCCESS CRITERIA: Predictable sync, 0 race conditions, 0 corruption

[WAVE-7.7] Validate codebase is small and maintainable
BLOCKS: []
BLOCKED_BY: [WAVE-6.6]
DETAILS:
- Count total lines of code
- Verify all files <200 lines (per Charter 5)
- Identify and refactor any files >200 lines
- Verify no duplicate code
- Verify no dead code
- Verify configuration drives behavior (not code)
- Verify dynamic/parameterizable systems
- Verify no hardcoded values
- Verify no special cases
- Document code organization
- SUCCESS CRITERIA: All files <200 lines, 0 duplication, config-driven

[WAVE-7.8] Validate migration accuracy is 100%
BLOCKS: []
BLOCKED_BY: [WAVE-6.7]
DETAILS:
- Re-verify row counts
- Re-verify referential integrity
- Re-verify data types
- Re-verify PDF coordinates (±0 pixels)
- Re-verify timestamps (UTC)
- Re-verify file paths
- Re-verify JSON fields
- Re-verify FK constraints
- Spot check 1000 random records again
- Document final migration statistics
- SUCCESS CRITERIA: 0 data loss, 100% accuracy, 8/8 validators pass

[WAVE-7.9] Validate performance meets all targets
BLOCKS: []
BLOCKED_BY: [WAVE-6.8]
DETAILS:
- Verify p95 latency <500ms for all endpoints
- Verify Time to Interactive <3s for all pages
- Verify bundle size <1MB
- Verify memory usage stable over time
- Verify no memory leaks
- Verify database queries optimized
- Verify concurrent user capacity ≥1000
- Document final performance metrics
- SUCCESS CRITERIA: All performance targets met

[WAVE-7.10] Validate security posture is production-ready
BLOCKS: []
BLOCKED_BY: [WAVE-6.9]
DETAILS:
- Re-run security audit
- Verify all critical vulnerabilities fixed
- Verify authentication required everywhere
- Verify authorization enforced everywhere
- Verify CSRF protection everywhere
- Verify input validation everywhere
- Verify output sanitization everywhere
- Document final security posture
- SUCCESS CRITERIA: 0 critical vulnerabilities, defense-in-depth

[WAVE-7.11] Validate accessibility is WCAG 2.1 AA compliant
BLOCKS: []
BLOCKED_BY: [WAVE-6.10]
DETAILS:
- Re-run accessibility audit
- Verify all WCAG 2.1 AA violations fixed
- Verify keyboard navigation works
- Verify screen reader support works
- Verify color contrast sufficient
- Verify ARIA labels complete
- Document final accessibility status
- SUCCESS CRITERIA: WCAG 2.1 AA compliant

[WAVE-7.12] Validate browser compatibility is complete
BLOCKS: []
BLOCKED_BY: [WAVE-6.11]
DETAILS:
- Re-test all major browsers
- Verify all features work
- Verify all layouts render correctly
- Verify all interactions work
- Document final browser support
- SUCCESS CRITERIA: Works on Chrome/Firefox/Safari/Edge (latest)

[WAVE-7.13] Validate load capacity meets requirements
BLOCKS: []
BLOCKED_BY: [WAVE-6.12]
DETAILS:
- Re-run load tests
- Verify handles peak load
- Verify response times acceptable under load
- Verify error rates acceptable under load
- Verify resource usage acceptable under load
- Document final load capacity
- SUCCESS CRITERIA: Handles 1000+ concurrent users with p95 <500ms

[WAVE-7.14] Validate disaster recovery procedures work
BLOCKS: []
BLOCKED_BY: [WAVE-6.13]
DETAILS:
- Re-test backup and restore
- Re-test crash recovery
- Re-test rollback procedures
- Verify RTO <15 min
- Verify RPO <5 min
- Document final recovery procedures
- SUCCESS CRITERIA: Tested recovery procedures, RTO/RPO met

[WAVE-7.15] Validate documentation is complete
BLOCKS: []
BLOCKED_BY: [WAVE-6.14]
DETAILS:
- Review all documentation
- Verify API docs complete
- Verify config docs complete
- Verify deployment docs complete
- Verify troubleshooting docs complete
- Verify user guides complete
- Verify admin guides complete
- Verify developer guides complete
- SUCCESS CRITERIA: Complete documentation for all areas

[WAVE-7.16] Validate user acceptance achieved
BLOCKS: []
BLOCKED_BY: [WAVE-6.15]
DETAILS:
- Collect final user feedback
- Address any remaining user issues
- Verify all critical workflows work
- Get final sign-off from stakeholders
- Document user acceptance
- SUCCESS CRITERIA: Stakeholder sign-off achieved

[WAVE-7.17] Final system validation and sign-off
BLOCKS: []
BLOCKED_BY: [WAVE-6.16]
DETAILS:
- Run final health check
- Verify all systems operational
- Verify all monitoring active
- Verify all alerting configured
- Verify all documentation current
- Verify all team training complete
- Get final sign-off for production
- Celebrate completion
- SUCCESS CRITERIA: Production-ready system, stakeholder sign-off

## EXECUTION SUMMARY

Total Items: 143
Total Waves: 7
Parallel Execution: Maximum parallelism within each wave using multiple gm subagents

Wave 1: 5 items (all parallel)
Wave 2: 5 items (all parallel after Wave 1)
Wave 3: 4 items (all parallel after Wave 2)
Wave 4: 8 items (all parallel after Wave 3)
Wave 5: 10 items (all parallel after Wave 4)
Wave 6: 16 items (sequential/parallel mix after Wave 5)
Wave 7: 17 items (all parallel after Wave 6)

Estimated Duration:
- Wave 1: 8-12 hours (discovery)
- Wave 2: 6-8 hours (analysis)
- Wave 3: 8-12 hours (schema/config)
- Wave 4: 40-60 hours (implementation)
- Wave 5: 30-40 hours (optimization)
- Wave 6: 20-30 hours (migration + testing)
- Wave 7: 12-16 hours (validation)
Total: 124-178 hours (15-22 business days with parallelism)

Critical Path:
WAVE-1.1 → WAVE-2.1 → WAVE-3.1 → WAVE-4.1 → WAVE-5.3 → WAVE-6.1 → WAVE-6.2 → WAVE-6.3 → WAVE-6.4 → WAVE-6.5 → WAVE-6.6 → WAVE-7.8

Success Criteria (ALL must pass):
✓ 100% feature parity with Friday-staging
✓ 100% feature parity with MyWorkReview-staging
✓ 100% RippleUI coverage (176/176 files)
✓ 100% WebJSX coverage (all UI files)
✓ Flawless hot reload (0 state loss, 0 dropped requests)
✓ Predictable state sync (0 race conditions, 0 corruption)
✓ Small codebase (all files <200 lines, 0 duplication)
✓ Zero data loss (230K+ records migrated, 8/8 validators pass)
✓ Performance targets (p95 <500ms, TTI <3s)
✓ Security posture (0 critical vulnerabilities)
✓ Accessibility (WCAG 2.1 AA compliant)
✓ Browser compatibility (Chrome/Firefox/Safari/Edge)
✓ Load capacity (1000+ concurrent users)
✓ Disaster recovery (RTO <15 min, RPO <5 min)
✓ Complete documentation
✓ User acceptance and stakeholder sign-off
